<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CareerVR ‚Äì Kh√°m ph√° con ƒë∆∞·ªùng s·ª± nghi·ªáp c·ªßa b·∫°n</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0b1220 0%, #0f1a33 100%);
      color: #e6f0ff;
      line-height: 1.6;
    }

    /* ===== HEADER ===== */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(11, 18, 32, 0.95);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(30, 42, 68, 0.5);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #1a3cff, #4d7cff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    nav {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    nav a {
      text-decoration: none;
      color: #9fb7ff;
      font-size: 0.95rem;
      transition: color 0.2s;
    }

    nav a.active {
      color: #fff;
      font-weight: 600;
      border-bottom: 2px solid #1a3cff;
      padding-bottom: 0.25rem;
    }

    nav a:hover {
      color: #cfe0ff;
    }

    /* ===== MAIN CONTAINER ===== */
    .wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .page {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== LANDING PAGE ===== */
    .hero {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: center;
      min-height: calc(100vh - 80px);
      padding: 4rem 0;
    }

    .hero-content h1 {
      font-size: 3.5rem;
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, #fff, #cfe0ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-content p {
      font-size: 1.2rem;
      color: #9fb7ff;
      margin-bottom: 2rem;
      line-height: 1.8;
    }

    .cta-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      max-width: 400px;
    }

    .btn {
      padding: 0.85rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #1a3cff, #1a3cff);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(26, 60, 255, 0.3);
    }

    .btn-secondary {
      background: transparent;
      border: 2px solid #2a3b66;
      color: #9fb7ff;
    }

    .btn-secondary:hover {
      border-color: #1a3cff;
      color: #cfe0ff;
    }

    .hero-visual {
      background: radial-gradient(circle at top right, rgba(26, 60, 255, 0.2), transparent);
      border-radius: 16px;
      border: 1px solid rgba(30, 42, 68, 0.5);
      padding: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 400px;
    }

    .icon-large {
      font-size: 6rem;
      opacity: 0.7;
    }

    /* ===== FEATURES SECTION ===== */
    .features {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
      margin: 6rem 0;
    }

    .feature-card {
      background: rgba(15, 31, 58, 0.5);
      border: 1px solid rgba(30, 42, 68, 0.5);
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s;
    }

    .feature-card:hover {
      background: rgba(15, 31, 58, 0.8);
      border-color: rgba(26, 60, 255, 0.5);
    }

    .feature-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .feature-card h3 {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
    }

    .feature-card p {
      color: #9fb7ff;
      font-size: 0.95rem;
    }

    /* ===== RIASEC TEST PAGE ===== */
    .test-container {
      max-width: 900px;
      margin: 3rem auto;
      padding-bottom: 4rem;
    }

    .progress-section {
      margin-bottom: 3rem;
    }

    .progress-bar {
      height: 8px;
      background: rgba(30, 42, 68, 0.5);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.75rem;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #1a3cff, #4d7cff);
      width: 0%;
      transition: width 0.4s ease;
    }

    .progress-text {
      font-size: 0.9rem;
      color: #9fb7ff;
      display: flex;
      justify-content: space-between;
    }

    .test-section {
      background: rgba(15, 31, 58, 0.6);
      border: 1px solid rgba(30, 42, 68, 0.5);
      border-radius: 12px;
      padding: 2.5rem;
      margin-bottom: 2rem;
    }

    .test-section h2 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
      color: #fff;
    }

    .question-item {
      margin-bottom: 2.5rem;
    }

    .question-item label {
      display: block;
      font-weight: 500;
      margin-bottom: 1rem;
      color: #cfe0ff;
    }

    .answer-options {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.75rem;
    }

    .answer-option {
      position: relative;
    }

    .answer-option input[type="radio"] {
      display: none;
    }

    .answer-option label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem;
      border: 2px solid rgba(30, 42, 68, 0.5);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s;
      background: transparent;
      margin: 0;
    }

    .answer-option input[type="radio"]:checked + label {
      background: linear-gradient(135deg, #1a3cff, #1a3cff);
      border-color: #1a3cff;
      color: #fff;
    }

    .answer-option label:hover {
      border-color: #2a3b66;
      background: rgba(26, 60, 255, 0.1);
    }

    .scale-explanation {
      background: rgba(26, 60, 255, 0.1);
      border-left: 3px solid #1a3cff;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      font-size: 0.95rem;
    }

    .scale-legend {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
      margin-top: 1rem;
    }

    .scale-item {
      text-align: center;
      padding: 0.75rem;
      background: rgba(15, 31, 58, 0.8);
      border-radius: 6px;
      font-size: 0.85rem;
      color: #9fb7ff;
    }

    /* ===== RESULTS PAGE ===== */
    .results-container {
      max-width: 900px;
      margin: 3rem auto;
    }

    .result-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .result-header h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .riasec-badge {
      display: inline-block;
      background: linear-gradient(135deg, #1a3cff, #4d7cff);
      padding: 1rem 2rem;
      border-radius: 8px;
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 1rem;
    }

    .major-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .major-card {
      background: rgba(15, 31, 58, 0.6);
      border: 2px solid rgba(30, 42, 68, 0.5);
      border-radius: 12px;
      padding: 2rem;
      transition: all 0.3s;
    }

    .major-card:hover {
      border-color: #1a3cff;
      background: rgba(15, 31, 58, 0.9);
    }

    .major-card.rank-1 {
      border-color: #ffd700;
    }

    .major-card.rank-2 {
      border-color: #c0c0c0;
    }

    .major-card.rank-3 {
      border-color: #cd7f32;
    }

    .major-badge {
      display: inline-block;
      background: rgba(26, 60, 255, 0.2);
      border: 1px solid #1a3cff;
      color: #4d7cff;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .major-card h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .major-code {
      color: #9fb7ff;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .major-card p {
      color: #9fb7ff;
      font-size: 0.95rem;
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .match-badge {
      display: inline-block;
      background: #081225;
      border: 1px solid #2a3b66;
      color: #cfe0ff;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* ===== DASHBOARD ===== */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 2rem;
      margin: 3rem 0;
    }

    .dashboard-card {
      background: rgba(15, 31, 58, 0.6);
      border: 1px solid rgba(30, 42, 68, 0.5);
      border-radius: 12px;
      padding: 2rem;
    }

    .dashboard-card h3 {
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 1rem;
      background: rgba(8, 18, 37, 0.5);
      border-radius: 8px;
      margin-bottom: 0.75rem;
      border-left: 3px solid #1a3cff;
    }

    .stat-value {
      font-weight: 700;
      color: #1a3cff;
      font-size: 1.1rem;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .hero {
        grid-template-columns: 1fr;
        gap: 2rem;
        padding: 2rem 0;
      }

      .hero-content h1 {
        font-size: 2.5rem;
      }

      .features {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .answer-options {
        grid-template-columns: repeat(3, 1fr);
      }

      .scale-legend {
        grid-template-columns: repeat(3, 1fr);
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      nav {
        gap: 1rem;
      }

      nav a {
        font-size: 0.85rem;
      }
    }

    /* ===== UTILITY ===== */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #9fb7ff;
    }

    .badge {
      display: inline-block;
      background: rgba(26, 60, 255, 0.2);
      border: 1px solid #1a3cff;
      color: #4d7cff;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">CareerVR</div>
  <nav>
    <a href="#" data-page="landing" class="nav-link active">Trang ch·ªß</a>
    <a href="#" data-page="test" class="nav-link">RIASEC Test</a>
    <a href="#" data-page="results" class="nav-link">K·∫øt qu·∫£</a>
    <a href="#" data-page="chatbot" class="nav-link">üí¨ AI Chatbot</a>
    <a href="#" data-page="dashboard" class="nav-link">Th·ªëng k√™</a>
  </nav>
</header>

<!-- MAIN CONTENT -->
<div class="wrapper">

  <!-- LANDING PAGE -->
  <section class="page active" id="landing">
    <div class="hero">
      <div class="hero-content">
        <h1>Kh√°m ph√° con ƒë∆∞·ªùng s·ª± nghi·ªáp c·ªßa b·∫°n</h1>
        <p>S·ª≠ d·ª•ng tr·∫Øc nghi·ªám RIASEC ƒë∆∞·ª£c c√° nh√¢n h√≥a ƒë·ªÉ t√¨m hi·ªÉu v·ªÅ nh·ªØng ng√†nh ngh·ªÅ ph√π h·ª£p nh·∫•t v·ªõi b·∫°n. Tr·∫£i nghi·ªám VR v√† nh·∫≠n l·ªùi khuy√™n t·ª´ AI.</p>
        <div class="cta-group">
          <button class="btn btn-primary" onclick="goPage('test')">B·∫Øt ƒë·∫ßu tr·∫Øc nghi·ªám</button>
          <button class="btn btn-secondary" onclick="goPage('dashboard')">Xem th·ªëng k√™</button>
        </div>
      </div>
      <div class="hero-visual">
        <div class="icon-large">üéØ</div>
      </div>
    </div>

    <div class="features">
      <div class="feature-card">
        <div class="feature-icon">üìä</div>
        <h3>RIASEC Test</h3>
        <p>50 c√¢u h·ªèi khoa h·ªçc ƒë·ªÉ ƒë√°nh gi√° s·ªü th√≠ch, k·ªπ nƒÉng, v√† t√≠nh c√°ch c·ªßa b·∫°n</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ü•Ω</div>
        <h3>Tr·∫£i nghi·ªám VR</h3>
        <p>Kh√°m ph√° c√°c ng√†nh ngh·ªÅ qua tr·ª±c quan h√≥a VR t∆∞∆°ng t√°c</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ü§ñ</div>
        <h3>T∆∞ v·∫•n AI</h3>
        <p>Chatbot th√¥ng minh gi√∫p b·∫°n tr·∫£ l·ªùi m·ªçi c√¢u h·ªèi v·ªÅ h·ªô s·ª± nghi·ªáp</p>
      </div>
    </div>
  </section>

  <!-- TEST PAGE -->
  <section class="page" id="test">
    <div class="test-container">
      <h1 style="text-align: center; margin-bottom: 3rem;">Tr·∫Øc nghi·ªám RIASEC</h1>

      <!-- Info input -->
      <div class="test-section" style="background: rgba(26, 60, 255, 0.1); border-color: rgba(26, 60, 255, 0.3);">
        <h2 style="font-size: 1.25rem;">Th√¥ng tin c√° nh√¢n</h2>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
          <div>
            <label for="name">H·ªç v√† t√™n</label>
            <input type="text" id="name" placeholder="Nguy·ªÖn VƒÉn A" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
          </div>
          <div>
            <label for="class">L·ªõp</label>
            <input type="text" id="class" placeholder="10A1" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
          </div>
          <div>
            <label for="school">Tr∆∞·ªùng</label>
            <input type="text" id="school" placeholder="THPT ..." style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
          </div>
        </div>
      </div>

      <!-- Progress -->
      <div class="progress-section">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
        </div>
        <div class="progress-text">
          <span id="progressText">0 / 50 c√¢u</span>
          <span id="estimatedTime">~10 ph√∫t</span>
        </div>
      </div>

      <!-- Scale explanation -->
      <div class="scale-explanation">
        <strong>H∆∞·ªõng d·∫´n tr·∫£ l·ªùi:</strong> V·ªõi m·ªói c√¢u h·ªèi, h√£y ƒë√°nh gi√° t·ª´ 1 (R·∫•t kh√¥ng ƒë√∫ng) ƒë·∫øn 5 (R·∫•t ƒë√∫ng)
        <div class="scale-legend">
          <div class="scale-item">1Ô∏è‚É£ R·∫•t kh√¥ng ƒë√∫ng</div>
          <div class="scale-item">2Ô∏è‚É£ Kh√¥ng ƒë√∫ng</div>
          <div class="scale-item">3Ô∏è‚É£ Ph√¢n v√¢n</div>
          <div class="scale-item">4Ô∏è‚É£ ƒê√∫ng</div>
          <div class="scale-item">5Ô∏è‚É£ R·∫•t ƒë√∫ng</div>
        </div>
      </div>

      <!-- Questions form -->
      <form id="testForm">
        <div id="questionsContainer"></div>
        <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center; flex-wrap: wrap;">
          <button type="submit" class="btn btn-primary">N·ªôp b√†i</button>
          <button type="button" class="btn btn-secondary" onclick="resetTest()">L√†m l·∫°i</button>
        </div>
      </form>
    </div>
  </section>

  <!-- RESULTS PAGE -->
  <section class="page" id="results">
    <div class="results-container">
      <div class="result-header">
        <h1>K·∫øt qu·∫£ c·ªßa b·∫°n</h1>
        <div class="riasec-badge" id="riasecDisplay">RAI</div>
        <p id="resultTime" style="color: #9fb7ff; margin-top: 1rem;">-</p>
      </div>

      <h2 style="margin: 2rem 0 1.5rem 0;">C√°c ng√†nh g·ª£i √Ω</h2>
      <div class="major-grid" id="majorContainer"></div>

      <div style="text-align: center; margin-top: 3rem;">
        <button class="btn btn-primary" onclick="goPage('test')">L√†m l·∫°i tr·∫Øc nghi·ªám</button>
      </div>
    </div>
  </section>

  <!-- CHATBOT PAGE -->
  <section class="page" id="chatbot">
    <div style="max-width: 900px; margin: 2rem auto; padding-bottom: 4rem;">
      <h1 style="text-align: center; margin-bottom: 2rem;">üí¨ T∆∞ v·∫•n AI h∆∞·ªõng nghi·ªáp</h1>

      <!-- Context card -->
      <div class="test-section" style="background: rgba(26, 60, 255, 0.1); border-color: rgba(26, 60, 255, 0.3); margin-bottom: 2rem;">
        <h3 style="margin-top: 0;">üìã H·ªì s∆° c·ªßa b·∫°n</h3>
        <div id="chatContext" style="color: #9fb7ff;">Ch∆∞a c√≥ d·ªØ li·ªáu. Vui l√≤ng l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc.</div>
      </div>

      <!-- Chat UI -->
      <div id="chatContainer" style="border: 1px solid rgba(30, 42, 68, 0.5); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; height: 700px; background: rgba(8, 18, 37, 0.8);">
        <!-- Messages -->
        <div id="messagesBox" style="flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
          <div style="color: #9fb7ff; font-size: 0.9rem;">
            <strong>ü§ñ AI:</strong> Xin ch√†o! T√¥i s·∫µn s√†ng t∆∞ v·∫•n cho b·∫°n d·ª±a tr√™n k·∫øt qu·∫£ RIASEC. Nh·∫•n n√∫t "Y√™u c·∫ßu t∆∞ v·∫•n" b√™n d∆∞·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu.
          </div>
        </div>

        <!-- Input area -->
        <div style="border-top: 1px solid rgba(30, 42, 68, 0.5); padding: 1rem; display: flex; gap: 0.75rem;">
          <input type="text" id="chatInput" placeholder="H·ªèi AI v·ªÅ h∆∞·ªõng nghi·ªáp c·ªßa b·∫°n..." style="flex: 1; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
          <button class="btn btn-primary" onclick="sendChatMessage()" style="padding: 0.75rem 1.5rem;">G·ª≠i</button>
        </div>
      </div>

      <!-- Action buttons -->
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap; justify-content: center;">
        <button class="btn btn-primary" id="consultBtn" onclick="requestCounsel()">‚ú® Y√™u c·∫ßu t∆∞ v·∫•n</button>
        <button class="btn btn-secondary" onclick="goPage('results')">‚Üê Quay l·∫°i k·∫øt qu·∫£</button>
      </div>

      <div id="loadingIndicator" style="text-align: center; color: #9fb7ff; margin-top: 1rem; display: none;">
        <span>‚è≥ ƒêang ch·ªù AI ph·∫£n h·ªìi...</span>
      </div>
    </div>
  </section>

  <!-- DASHBOARD -->
  <section class="page" id="dashboard">
    <h1 style="margin-top: 3rem; margin-bottom: 2rem;">Th·ªëng k√™ & Qu·∫£n l√Ω d·ªØ li·ªáu</h1>
    <div id="dashboardContent"></div>
    <div style="text-align: center; margin-top: 3rem; margin-bottom: 3rem;">
      <button class="btn btn-secondary" onclick="clearAllData()">Xo√° t·∫•t c·∫£ d·ªØ li·ªáu</button>
    </div>
  </section>

</div>

<script>
  // ===== CONFIG & CONSTANTS =====
  const DB_KEY = 'careerVR_records';
  const RIASEC_KEY = 'careerVR_current';

  // Dummy RIASEC questions (50 total)
  const RIASEC_QUESTIONS = [
    { q: "T√¥i th√≠ch l√†m vi·ªác v·ªõi c√°c c√¥ng c·ª• th·ªß c√¥ng", r: "R" },
    { q: "T√¥i th√≠ch gi·∫£i quy·∫øt c√°c b√†i to√°n ph·ª©c t·∫°p", r: "I" },
    { q: "T√¥i th√≠ch s√°ng t·∫°o v√† bi·ªÉu ƒë·∫°t b·∫£n th√¢n", r: "A" },
    { q: "T√¥i th√≠ch gi√∫p ƒë·ª° ng∆∞·ªùi kh√°c", r: "S" },
    { q: "T√¥i th√≠ch l√£nh ƒë·∫°o v√† c√≥ ·∫£nh h∆∞·ªüng", r: "E" },
    { q: "T√¥i th√≠ch c√¥ng vi·ªác c√≥ quy t·∫Øc r√µ r√†ng", r: "C" },
    { q: "T√¥i c·∫£m th·∫•y tho·∫£i m√°i khi l√†m c√¥ng vi·ªác th·ª±c t·∫ø", r: "R" },
    { q: "T√¥i h·ª©ng th√∫ v·ªõi khoa h·ªçc v√† nghi√™n c·ª©u", r: "I" },
    { q: "T√¥i th√≠ch tham gia c√°c ho·∫°t ƒë·ªông s√°ng t·∫°o", r: "A" },
    { q: "T√¥i th√≠ch h·ªçc h·ªèi t·ª´ ng∆∞·ªùi kh√°c", r: "S" },
    { q: "T√¥i c√≥ kh·∫£ nƒÉng thuy·∫øt ph·ª•c ng∆∞·ªùi kh√°c", r: "E" },
    { q: "T√¥i lu√¥n c·∫©n th·∫≠n v·ªõi chi ti·∫øt", r: "C" },
    { q: "T√¥i th√≠ch c√¥ng vi·ªác ngo√†i tr·ªùi", r: "R" },
    { q: "T√¥i th√≠ch t√¨m hi·ªÉu c√°ch m·ªçi th·ª© ho·∫°t ƒë·ªông", r: "I" },
    { q: "T√¥i y√™u th√≠ch √¢m nh·∫°c, ngh·ªá thu·∫≠t ho·∫∑c vƒÉn h·ªçc", r: "A" },
    { q: "T√¥i th√≠ch l√†m vi·ªác nh√≥m", r: "S" },
    { q: "T√¥i th√≠ch ƒë·ªÅ ra k·∫ø ho·∫°ch v√† t·ªï ch·ª©c", r: "E" },
    { q: "T√¥i th√≠ch c√¥ng vi·ªác c·∫ßn s·ª± ch√≠nh x√°c", r: "C" },
    { q: "T√¥i th√≠ch s·ª≠a ch·ªØa c√°c v·∫≠t d·ª•ng", r: "R" },
    { q: "T√¥i th√≠ch s·ª≠ d·ª•ng m√°y t√≠nh ho·∫∑c c√¥ng ngh·ªá", r: "I" },
    { q: "T√¥i th√≠ch thi·∫øt k·∫ø ho·∫∑c trang tr√≠", r: "A" },
    { q: "T√¥i th√≠ch chƒÉm s√≥c ng∆∞·ªùi kh√°c", r: "S" },
    { q: "T√¥i th√≠ch c√¥ng vi·ªác v·ªÅ giao d·ªãch th∆∞∆°ng m·∫°i", r: "E" },
    { q: "T√¥i th√≠ch s·∫Øp x·∫øp v√† qu·∫£n l√Ω t√†i li·ªáu", r: "C" },
    { q: "T√¥i th√≠ch c√°c ho·∫°t ƒë·ªông kh√°m ph√°", r: "R" },
    { q: "T√¥i th√≠ch ph√¢n t√≠ch d·ªØ li·ªáu", r: "I" },
    { q: "T√¥i th√≠ch vi·∫øt ho·∫∑c k·ªÉ chuy·ªán", r: "A" },
    { q: "T√¥i th√≠ch gi√°o d·ª•c nh·ªØng ng∆∞·ªùi kh√°c", r: "S" },
    { q: "T√¥i th√≠ch kh·ªüi ƒë·ªông c√°c d·ª± √°n m·ªõi", r: "E" },
    { q: "T√¥i th√≠ch tu√¢n theo quy tr√¨nh ti√™u chu·∫©n", r: "C" },
    { q: "T√¥i c√≥ k·ªπ nƒÉng c∆° kh√≠ t·ªët", r: "R" },
    { q: "T√¥i th√≠ch h·ªçc t·∫≠p li√™n t·ª•c", r: "I" },
    { q: "T√¥i th√≠ch di·ªÖn ƒë·∫°t √Ω t∆∞·ªüng c·ªßa m√¨nh", r: "A" },
    { q: "T√¥i quan t√¢m ƒë·∫øn ph√∫c l·ª£i c·ªßa ng∆∞·ªùi kh√°c", r: "S" },
    { q: "T√¥i th√≠ch bu√¥n b√°n ho·∫∑c kinh doanh", r: "E" },
    { q: "T√¥i th√≠ch c√¥ng vi·ªác c√≥ c·∫•u tr√∫c", r: "C" },
    { q: "T√¥i th√≠ch l√†m vi·ªác tr·ª±c ti·∫øp tr√™n c√°c d·ª± √°n", r: "R" },
    { q: "T√¥i c√≥ s·ªü th√≠ch m·∫°nh v·ªÅ t·ª± nhi√™n", r: "I" },
    { q: "T√¥i th√≠ch th·ª≠ nghi·ªám nh·ªØng c√°ch ti·∫øp c·∫≠n m·ªõi", r: "A" },
    { q: "T√¥i th√≠ch l·∫Øng nghe nh·ªØng ng∆∞·ªùi kh√°c", r: "S" },
    { q: "T√¥i th√≠ch qu·∫£n l√Ω m·ªôt nh√≥m ng∆∞·ªùi", r: "E" },
    { q: "T√¥i th√≠ch c√¥ng vi·ªác y√™u c·∫ßu chuy√™n m√¥n cao", r: "C" },
    { q: "T√¥i y√™u th√≠ch c√°c ƒë·ªì v·∫≠t c√≥ h√¨nh d√°ng v√† k·∫øt c·∫•u", r: "R" },
    { q: "T√¥i th√≠ch s·ª≠ d·ª•ng to√°n h·ªçc trong c√¥ng vi·ªác", r: "I" },
    { q: "T√¥i th√≠ch bi·ªÉu di·ªÖn c·∫£m x√∫c qua ngh·ªá thu·∫≠t", r: "A" },
    { q: "T√¥i th√≠ch h·ªó tr·ª£ nh·ªØng ng∆∞·ªùi g·∫∑p kh√≥ khƒÉn", r: "S" },
    { q: "T√¥i th√≠ch n·∫Øm quy·ªÅn ki·ªÉm so√°t", r: "E" },
    { q: "T√¥i th√≠ch c√¥ng vi·ªác l·∫∑p ƒëi l·∫∑p l·∫°i nh∆∞ng quan tr·ªçng", r: "C" },
    { q: "T√¥i th√≠ch lao ƒë·ªông ch√¢n tay", r: "R" },
    { q: "T√¥i th√≠ch kh√°m ph√° c√°c √Ω t∆∞·ªüng tr·ª´u t∆∞·ª£ng", r: "I" },
    { q: "T√¥i th√≠ch c√°c ho·∫°t ƒë·ªông ho·∫°t ƒë·ªông gi·∫£i tr√≠ ho·∫∑c vui v·∫ª", r: "A" }
  ];

  // Dummy major recommendations
  const MAJORS_DB = {
    "R-I-A": [
      { name: "Ki·∫øn tr√∫c", code: "7310", path: "ƒêH Ki·∫øn tr√∫c (4 nƒÉm)" },
      { name: "Thi·∫øt k·∫ø n·ªôi th·∫•t", code: "7220", path: "ƒêH M·ªπ thu·∫≠t ·ª©ng d·ª•ng (4 nƒÉm)" }
    ],
    "I-R-A": [
      { name: "Khoa h·ªçc m√°y t√≠nh", code: "7480", path: "ƒêH C√¥ng ngh·ªá th√¥ng tin (4 nƒÉm)" },
      { name: "K·ªπ thu·∫≠t ph·∫ßn m·ªÅm", code: "7310", path: "ƒêH K·ªπ thu·∫≠t (4 nƒÉm)" }
    ],
    "S-E-C": [
      { name: "Qu·∫£n tr·ªã kinh doanh", code: "7340", path: "ƒêH Kinh t·∫ø (4 nƒÉm)" },
      { name: "T√¢m l√Ω h·ªçc", code: "7320", path: "ƒêH S∆∞ ph·∫°m (4 nƒÉm)" }
    ],
    "E-C-S": [
      { name: "Marketing & B√°n h√†ng", code: "7360", path: "ƒêH Ngo·∫°i th∆∞∆°ng (4 nƒÉm)" },
      { name: "Qu·∫£n l√Ω nh√¢n s·ª±", code: "7340", path: "ƒêH Kinh t·∫ø (4 nƒÉm)" }
    ]
  };

  // ===== UTILS =====
  const $ = (id) => document.getElementById(id);
  const readDB = () => JSON.parse(localStorage.getItem(DB_KEY) || '[]');
  const writeDB = (arr) => localStorage.setItem(DB_KEY, JSON.stringify(arr));
  const readCurrent = () => JSON.parse(localStorage.getItem(RIASEC_KEY) || 'null');
  const writeCurrent = (obj) => localStorage.setItem(RIASEC_KEY, JSON.stringify(obj));

  // ===== PAGE NAVIGATION =====
  function goPage(page) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    $(page).classList.add('active');

    document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
    document.querySelector(`[data-page="${page}"]`).classList.add('active');

    if (page === 'results') showResults();
    if (page === 'dashboard') showDashboard();
  }

  // ===== INIT TEST PAGE =====
  function initTest() {
    const container = $('questionsContainer');
    container.innerHTML = '';

    RIASEC_QUESTIONS.forEach((q, idx) => {
      const html = `
        <div class="question-item">
          <label>C√¢u ${idx + 1}. ${q.q}</label>
          <div class="answer-options">
            ${[1, 2, 3, 4, 5].map(v => `
              <div class="answer-option">
                <input type="radio" name="q${idx}" value="${v}" id="q${idx}_${v}" onchange="updateProgress()">
                <label for="q${idx}_${v}">${v}</label>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      container.innerHTML += html;
    });
  }

  // ===== PROGRESS TRACKING =====
  function updateProgress() {
    const answered = document.querySelectorAll('input[type="radio"]:checked').length;
    const total = 50;
    const percent = (answered / total) * 100;

    $('progressFill').style.width = percent + '%';
    $('progressText').textContent = `${answered} / ${total} c√¢u`;

    if (answered === total) {
      $('estimatedTime').textContent = '‚úÖ S·∫µn s√†ng n·ªôp';
    }
  }

  // ===== CALCULATE RIASEC SCORES =====
  function calculateRIASEC() {
    const scores = { R: 0, I: 0, A: 0, S: 0, E: 0, C: 0 };
    let answered = 0;

    RIASEC_QUESTIONS.forEach((q, idx) => {
      const value = parseInt(document.querySelector(`input[name="q${idx}"]:checked`)?.value) || 0;
      if (value) {
        scores[q.r] += value;
        answered++;
      }
    });

    if (answered !== 50) {
      alert('Vui l√≤ng tr·∫£ l·ªùi h·∫øt 50 c√¢u!');
      return null;
    }

    const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
    const top3 = sorted.slice(0, 3).map(x => x[0]);

    return { scores, top3, answered };
  }

  // ===== SUBMIT TEST =====
  $('testForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const result = calculateRIASEC();
    if (!result) return;

    const record = {
      name: $('name').value || '·∫®n danh',
      class: $('class').value || '-',
      school: $('school').value || '-',
      riasec: result.top3,
      scores: result.scores,
      time: new Date().toISOString()
    };

    const db = readDB();
    db.push(record);
    writeDB(db);
    writeCurrent(record);

    goPage('results');
  });

  // ===== SHOW RESULTS =====
  function showResults() {
    const current = readCurrent();
    if (!current) {
      $('majorContainer').innerHTML = '<div class="empty-state">Vui l√≤ng l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc</div>';
      return;
    }

    $('riasecDisplay').textContent = current.riasec.join('-');
    $('resultTime').textContent = `Ng√†y: ${new Date(current.time).toLocaleDateString('vi-VN')}`;

    const key = current.riasec.join('-');
    const majors = MAJORS_DB[key] || MAJORS_DB['S-E-C'];

    const html = majors.map((m, idx) => `
      <div class="major-card rank-${idx + 1}">
        <div class="major-badge">G·ª£i √Ω #${idx + 1}</div>
        <h3>${m.name}</h3>
        <div class="major-code">M√£ ng√†nh: <strong>${m.code}</strong></div>
        <p>${m.path}</p>
      </div>
    `).join('');

    $('majorContainer').innerHTML = html;
  }

  // ===== SHOW DASHBOARD =====
  function showDashboard() {
    const db = readDB();
    if (!db.length) {
      $('dashboardContent').innerHTML = '<div class="empty-state">Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc.</div>';
      return;
    }

    const stats = {};
    db.forEach(r => {
      const key = r.school || 'Kh√¥ng r√µ';
      stats[key] = (stats[key] || 0) + 1;
    });

    const html = `
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <h3>üìä T·ªïng s·ªë b√†i l√†m</h3>
          <div class="stat-item">
            <span>T·∫•t c·∫£ b√†i tr·∫Øc nghi·ªám</span>
            <span class="stat-value">${db.length}</span>
          </div>
        </div>
        <div class="dashboard-card">
          <h3>üè´ Theo tr∆∞·ªùng</h3>
          ${Object.entries(stats).map(([k, v]) => `
            <div class="stat-item">
              <span>${k}</span>
              <span class="stat-value">${v}</span>
            </div>
          `).join('')}
        </div>
      </div>
    `;

    $('dashboardContent').innerHTML = html;
  }

  // ===== RESET TEST =====
  function resetTest() {
    if (!confirm('Xo√° h·∫øt d·ªØ li·ªáu nh·∫≠p li·ªáu?')) return;
    document.getElementById('testForm').reset();
    $('progressFill').style.width = '0%';
    $('progressText').textContent = '0 / 50 c√¢u';
    $('estimatedTime').textContent = '~10 ph√∫t';
  }

  // ===== CLEAR ALL DATA =====
  function clearAllData() {
    if (!confirm('Xo√° t·∫•t c·∫£ d·ªØ li·ªáu l∆∞u tr·ªØ? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) return;
    writeDB([]);
    writeCurrent(null);
    showDashboard();
    alert('ƒê√£ xo√° t·∫•t c·∫£ d·ªØ li·ªáu');
  }

  // ===== CHATBOT =====
  // Use relative URL - works on localhost and production
  const API_BASE = window.location.origin;

  function updateChatContext() {
    const current = readCurrent();
    const ctx = $('chatContext');
    if (!ctx) return;

    if (!current) {
      ctx.innerHTML = '‚ùå Ch∆∞a c√≥ d·ªØ li·ªáu. Vui l√≤ng <strong onclick="goPage(\'test\')">l√†m tr·∫Øc nghi·ªám</strong> tr∆∞·ªõc.';
      $('consultBtn').disabled = true;
      return;
    }

    ctx.innerHTML = `
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div>
          <strong>üë§ H·ªçc sinh:</strong> ${current.name || '·∫®n danh'}
        </div>
        <div>
          <strong>üìö L·ªõp / Tr∆∞·ªùng:</strong> ${current.class || '-'} / ${current.school || '-'}
        </div>
        <div>
          <strong>üéØ RIASEC:</strong> <span style="background: rgba(26, 60, 255, 0.3); padding: 0.25rem 0.5rem; border-radius: 4px;">${current.riasec.join('-')}</span>
        </div>
        <div>
          <strong>‚è±Ô∏è Ng√†y:</strong> ${new Date(current.time).toLocaleDateString('vi-VN')}
        </div>
      </div>
    `;
    $('consultBtn').disabled = false;
  }

  function formatMarkdownText(text) {
    // Convert markdown-style formatting to HTML
    let html = text
      // Bold: **text** ‚Üí <strong>text</strong>
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      // Line breaks: preserve them
      .replace(/\n/g, '<br>')
      // Headers: Roman numerals + ALL CAPS
      .replace(/^(I+\..*?)$/gm, '<h4 style="margin: 1rem 0 0.5rem 0; color: #cfe0ff; font-size: 1rem;">$1</h4>')
      // Numbered lists: 1. ‚Üí formatted list
      .replace(/^(\d+\.\s)/gm, '<div style="margin-left: 1rem; margin-bottom: 0.5rem;">$1')
      // Close numbered list items
      .replace(/(<div style="margin-left: 1rem;.*?)<br>/g, '$1</div><br>')
      // Dashes to bullet points: - ‚Üí ‚Ä¢
      .replace(/^- /gm, '&nbsp;&nbsp;‚Ä¢ ');
    
    return html;
  }

  function addChatMessage(sender, text, isLoading = false) {
    const messagesBox = $('messagesBox');
    const msg = document.createElement('div');
    msg.style.cssText = 'color: #9fb7ff; font-size: 0.95rem; line-height: 1.8; margin-bottom: 1rem; white-space: pre-wrap; word-wrap: break-word;';

    if (sender === 'user') {
      msg.innerHTML = `<strong style="color: #cfe0ff;">üë§ B·∫°n:</strong> ${text}`;
    } else {
      const formattedText = formatMarkdownText(text);
      msg.innerHTML = `<div style="color: #4d7cff;"><strong>ü§ñ AI:</strong></div><div style="margin-top: 0.5rem; color: #9fb7ff;">${isLoading ? '<em>ƒêang suy nghƒ©...</em>' : formattedText}</div>`;
    }

    messagesBox.appendChild(msg);
    messagesBox.scrollTop = messagesBox.scrollHeight;
  }

  async function requestCounsel() {
    const current = readCurrent();
    if (!current) {
      alert('Vui l√≤ng l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc');
      return;
    }

    const $consultBtn = $('consultBtn');
    const $loadingIndicator = $('loadingIndicator');

    $consultBtn.disabled = true;
    $loadingIndicator.style.display = 'block';

    try {
      // Build answer array: reconstruct from RIASEC scores proportionally
      const answerArray = [];
      const scores = current.scores;
      const letters = ['R', 'I', 'A', 'S', 'E', 'C'];
      let answerIdx = 0;

      // Distribute answers based on original RIASEC allocation (50 questions total)
      for (let i = 0; i < 50; i++) {
        const letterIdx = i % 6;
        const letter = letters[letterIdx];
        const baseScore = Math.round(scores[letter] / 6);
        const variance = Math.floor(Math.random() * 2) - 1;
        answerArray.push(Math.max(1, Math.min(5, baseScore + variance)));
      }

      console.log('üì§ Sending to API:', {
        name: current.name,
        class: current.class,
        school: current.school,
        answers_json: answerArray
      });

      const response = await fetch(`${API_BASE}/run-riasec`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: current.name || '·∫®n danh',
          class: current.class || '-',
          school: current.school || '-',
          answers_json: answerArray
        })
      });

      if (!response.ok) {
        let errorMsg = `HTTP ${response.status}`;
        try {
          const errorData = await response.json();
          errorMsg = errorData.detail || errorMsg;
        } catch (e) {}
        throw new Error(errorMsg);
      }

      const data = await response.json();
      const aiResponse = data.data.outputs.text || 'Kh√¥ng c√≥ ph·∫£n h·ªìi t·ª´ AI';

      addChatMessage('ai', aiResponse);
    } catch (err) {
      console.error('‚ùå Fetch error:', err);
      const errorMsg = err.message;
      
      if (errorMsg.includes('Failed to fetch') || errorMsg.includes('NetworkError')) {
        addChatMessage('ai', `
          ‚ùå <strong>L·ªói k·∫øt n·ªëi:</strong> Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi backend API (${API_BASE}).<br><br>
          <strong>C√°ch kh·∫Øc ph·ª•c:</strong><br>
          1. M·ªü terminal v√† ch·∫°y:<br>
          <code style="background: #081225; padding: 0.25rem 0.5rem; border-radius: 4px;">uvicorn backend.main:app --reload --host 0.0.0.0 --port 8000</code><br>
          2. Sau ƒë√≥ t·∫£i l·∫°i trang web n√†y
        `);
      } else {
        addChatMessage('ai', `‚ùå <strong>L·ªói API:</strong> ${errorMsg}`);
      }
    } finally {
      $consultBtn.disabled = false;
      $loadingIndicator.style.display = 'none';
    }
  }

  function sendChatMessage() {
    const input = $('chatInput');
    const text = input.value.trim();
    if (!text) return;

    addChatMessage('user', text);
    input.value = '';

    // Placeholder: AI echo response
    setTimeout(() => {
      addChatMessage('ai', `B·∫°n h·ªèi: "${text}". T√¥i ƒëang h·ªçc c√°ch tr·∫£ l·ªùi c√¢u h·ªèi n√†y. Vui l√≤ng nh·∫•n "Y√™u c·∫ßu t∆∞ v·∫•n" ƒë·ªÉ nh·∫≠n ph√¢n t√≠ch chi ti·∫øt.`);
    }, 500);
  }

  // Enter to send
  $('chatInput')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendChatMessage();
  });

  // ===== INIT =====
  document.querySelectorAll('.nav-link').forEach(a => {
    a.addEventListener('click', (e) => {
      e.preventDefault();
      const page = a.dataset.page;
      if (page === 'chatbot') updateChatContext();
      goPage(page);
    });
  });

  // Init test page when landing is loaded
  window.addEventListener('load', () => {
    initTest();
  });
</script>

</body>
</html>
