<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Tr·∫Øc nghi·ªám H∆∞·ªõng nghi·ªáp RIASEC (50 c√¢u)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 10px;
    }
    h2, h3 {
      text-align: center;
    }
    .info input {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      font-size: 16px;
    }
    .question {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .q-title {
      font-weight: bold;
      margin-bottom: 6px;
    }
    .options label {
      margin-right: 12px;
    }
    button {
      padding: 12px 24px;
      font-size: 18px;
      margin-top: 20px;
      cursor: pointer;
    }
    pre {
      white-space: pre-wrap;
      background: #f6f6f6;
      padding: 12px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
  <h2 style="margin:0">TR·∫ÆC NGHI·ªÜM H∆Ø·ªöNG NGHI·ªÜP RIASEC (50 C√ÇU)</h2>
  <button id="devModeBtn" style="padding:6px 12px;background:#ff6b6b;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:12px;font-weight:bold">üß™ Dev Mode OFF</button>
</div>

<p>
<b>Thang ƒëo:</b><br>
1 = R·∫•t kh√¥ng ƒë√∫ng v·ªõi t√¥i |
2 = Kh√¥ng ƒë√∫ng |
3 = Ph√¢n v√¢n |
4 = ƒê√∫ng |
5 = R·∫•t ƒë√∫ng v·ªõi t√¥i
</p>

<div class="info">
  <input id="name" placeholder="H·ªç v√† t√™n h·ªçc sinh" required>
  <input id="class" placeholder="L·ªõp ƒëang h·ªçc" required>
  <input id="school" placeholder="Tr∆∞·ªùng ƒëang h·ªçc" required>
</div>

<form id="quiz">
   <div id="questions"></div>
   <div style="display:flex;gap:10px;flex-wrap:wrap">
     <button type="submit">Xem k·∫øt qu·∫£ h∆∞·ªõng nghi·ªáp</button>
     <button type="button" id="devAutoFill" style="background:#ff6b6b;color:#fff;padding:12px 24px;font-size:18px;border:none;border-radius:6px;cursor:pointer;display:none" onclick="fillRandomAnswers(); setTimeout(() => document.getElementById('quiz').dispatchEvent(new Event('submit')), 300)">üß™ Auto Fill & Submit</button>
   </div>
</form>

<h3>K·∫æT QU·∫¢ T∆Ø V·∫§N</h3>
<pre id="result">Vui l√≤ng ho√†n th√†nh tr·∫Øc nghi·ªám ƒë·ªÉ xem k·∫øt qu·∫£.</pre>

<script>
// ================== DEV MODE ==================
const DEV_MODE_KEY = 'devMode';
let devModeEnabled = localStorage.getItem(DEV_MODE_KEY) === 'true';
const randomAnswer = () => Math.floor(Math.random() * 5) + 1; // 1-5

window.fillRandomAnswers = function fillRandomAnswers() {
  const formInputs = document.querySelectorAll('input[type="radio"]');
  const groups = {};
  
  formInputs.forEach(inp => {
    if (!groups[inp.name]) groups[inp.name] = [];
    groups[inp.name].push(inp);
  });
  
  Object.values(groups).forEach(radios => {
    const randomVal = randomAnswer();
    const selected = radios.find(r => r.value == randomVal);
    if (selected) selected.checked = true;
  });
  
  console.log('‚úÖ Dev Mode: Filled all 50 answers randomly');
};

const devModeBtn = document.getElementById('devModeBtn');
const devAutoFillBtn = document.getElementById('devAutoFill');

const updateDevModeUI = () => {
  if (devModeBtn) {
    devModeBtn.textContent = devModeEnabled ? 'üß™ Dev Mode ON' : 'üß™ Dev Mode OFF';
    devModeBtn.style.background = devModeEnabled ? '#51cf66' : '#ff6b6b';
  }
  if (devAutoFillBtn) {
    devAutoFillBtn.style.display = devModeEnabled ? 'block' : 'none';
  }
};

if (devModeBtn) {
  devModeBtn.addEventListener('click', () => {
    devModeEnabled = !devModeEnabled;
    localStorage.setItem(DEV_MODE_KEY, devModeEnabled);
    updateDevModeUI();
    console.log(devModeEnabled ? 'üß™ Dev Mode ENABLED' : 'üß™ Dev Mode DISABLED');
  });
  updateDevModeUI();
}

document.addEventListener('keydown', (e) => {
  if (e.shiftKey && e.key === 'D') {
    devModeBtn?.click();
  }
});

// ================== API BACKEND ==================
// Detect API URL based on environment
const API_URL = (() => {
  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    return 'http://localhost:8000/run-riasec';
  }
  // Production: use same host or custom backend URL
  const backendUrl = window.location.hostname === 'localhost' 
    ? 'http://localhost:8000'
    : window.location.origin;
  return backendUrl + '/run-riasec';
})();

// ================== DANH S√ÅCH 50 C√ÇU H·ªéI ==================
const questions = [
  "T√¥i th√≠ch s·ª≠a ch·ªØa, l·∫Øp r√°p ƒë·ªì ƒë·∫°c ho·∫∑c thi·∫øt b·ªã.",
  "T√¥i h·ª©ng th√∫ v·ªõi c√°c c√¥ng vi·ªác c·∫ßn v·∫≠n ƒë·ªông ho·∫∑c l√†m ngo√†i tr·ªùi.",
  "T√¥i th√≠ch l√†m vi·ªác v·ªõi c√¥ng c·ª•, m√°y m√≥c h∆°n l√† gi·∫•y t·ªù.",
  "T√¥i h·ªçc t·ªët h∆°n khi ƒë∆∞·ª£c l√†m tr·ª±c ti·∫øp thay v√¨ ch·ªâ nghe gi·∫£ng.",

  "T√¥i th√≠ch t√¨m hi·ªÉu nguy√™n nh√¢n ‚Äì k·∫øt qu·∫£ c·ªßa m·ªôt v·∫•n ƒë·ªÅ.",
  "T√¥i th√≠ch c√°c m√¥n h·ªçc c·∫ßn suy lu·∫≠n nh∆∞ To√°n, L√Ω, H√≥a.",
  "T√¥i th∆∞·ªùng ƒë·∫∑t c√¢u h·ªèi ‚Äúv√¨ sao‚Äù khi h·ªçc ki·∫øn th·ª©c m·ªõi.",
  "T√¥i th√≠ch ph√¢n t√≠ch d·ªØ li·ªáu, th√≠ nghi·ªám ho·∫∑c nghi√™n c·ª©u.",

  "T√¥i th√≠ch v·∫Ω, vi·∫øt, thi·∫øt k·∫ø ho·∫∑c s√°ng t·∫°o n·ªôi dung.",
  "T√¥i kh√¥ng th√≠ch c√¥ng vi·ªác qu√° khu√¥n m·∫´u, l·∫∑p l·∫°i.",
  "T√¥i th√≠ch th·ªÉ hi·ªán √Ω t∆∞·ªüng v√† c·∫£m x√∫c c√° nh√¢n.",
  "T√¥i h·ª©ng th√∫ v·ªõi √¢m nh·∫°c, m·ªπ thu·∫≠t ho·∫∑c truy·ªÅn th√¥ng.",

  "T√¥i th√≠ch gi√∫p ƒë·ª°, h∆∞·ªõng d·∫´n ho·∫∑c h·ªó tr·ª£ ng∆∞·ªùi kh√°c.",
  "T√¥i c·∫£m th·∫•y vui khi l√†m vi·ªác nh√≥m.",
  "T√¥i c√≥ xu h∆∞·ªõng l·∫Øng nghe v√† chia s·∫ª v·ªõi m·ªçi ng∆∞·ªùi.",
  "T√¥i th√≠ch c√°c c√¥ng vi·ªác li√™n quan ƒë·∫øn gi√°o d·ª•c, y t·∫ø ho·∫∑c x√£ h·ªôi.",

  "T√¥i th√≠ch l√£nh ƒë·∫°o ho·∫∑c thuy·∫øt ph·ª•c ng∆∞·ªùi kh√°c.",
  "T√¥i h·ª©ng th√∫ v·ªõi kinh doanh, b√°n h√†ng ho·∫∑c t·ªï ch·ª©c ho·∫°t ƒë·ªông.",
  "T√¥i t·ª± tin khi tr√¨nh b√†y √Ω ki·∫øn tr∆∞·ªõc ƒë√°m ƒë√¥ng.",
  "T√¥i th√≠ch ƒë·∫∑t m·ª•c ti√™u v√† chinh ph·ª•c k·∫øt qu·∫£.",

  "T√¥i th√≠ch c√¥ng vi·ªác r√µ r√†ng, c√≥ quy tr√¨nh c·ª• th·ªÉ.",
  "T√¥i c·∫©n th·∫≠n v·ªõi s·ªë li·ªáu, h·ªì s∆° v√† gi·∫•y t·ªù.",
  "T√¥i th√≠ch l√†m vi·ªác c√≥ k·∫ø ho·∫°ch, th·ªùi gian bi·ªÉu r√µ r√†ng.",
  "T√¥i c·∫£m th·∫•y y√™n t√¢m khi m·ªçi vi·ªác ƒë∆∞·ª£c s·∫Øp x·∫øp g·ªçn g√†ng.",

  "T√¥i h·ªçc t·ªët h∆°n khi ƒë∆∞·ª£c th·ª±c h√†nh, thao t√°c tr·ª±c ti·∫øp.",
  "T√¥i h·ªçc t·ªët c√°c m√¥n c·∫ßn t∆∞ duy logic v√† ph√¢n t√≠ch.",
  "T√¥i s·ª≠ d·ª•ng m√°y t√≠nh v√† ph·∫ßn m·ªÅm h·ªçc t·∫≠p hi·ªáu qu·∫£.",
  "T√¥i giao ti·∫øp v√† tr√¨nh b√†y √Ω ki·∫øn kh√° t·ª± tin.",
  "T√¥i l√†m t·ªët c√°c c√¥ng vi·ªác c·∫ßn thao t√°c tay ho·∫∑c k·ªπ thu·∫≠t.",
  "T√¥i ti·∫øp thu nhanh khi ƒë∆∞·ª£c quan s√°t v√† l√†m th·ª≠.",
  "T√¥i c√≥ kh·∫£ nƒÉng ph√¢n t√≠ch v·∫•n ƒë·ªÅ v√† t√¨m c√°ch gi·∫£i quy·∫øt.",
  "T√¥i th√≠ch c√°c nhi·ªám v·ª• c·∫ßn suy lu·∫≠n, t√≠nh to√°n.",
  "T√¥i c√≥ kh·∫£ nƒÉng s√°ng t·∫°o √Ω t∆∞·ªüng m·ªõi.",
  "T√¥i th∆∞·ªùng c√≥ c√°ch l√†m ri√™ng, kh√¥ng th√≠ch b·ªã b√≥ bu·ªôc.",
  "T√¥i c√≥ kh·∫£ nƒÉng l·∫Øng nghe v√† h·ªó tr·ª£ ng∆∞·ªùi kh√°c.",
  "T√¥i c·∫£m th·∫•y tho·∫£i m√°i khi l√†m vi·ªác nh√≥m.",
  "T√¥i t·ª± tin ƒë∆∞a ra √Ω ki·∫øn v√† d·∫´n d·∫Øt nh√≥m.",
  "T√¥i l√†m vi·ªác hi·ªáu qu·∫£ khi c√≥ k·∫ø ho·∫°ch r√µ r√†ng.",

  "T√¥i coi tr·ªçng thu nh·∫≠p v√† c∆° h·ªôi thƒÉng ti·∫øn.",
  "T√¥i mong mu·ªën c√¥ng vi·ªác ·ªïn ƒë·ªãnh, l√¢u d√†i.",
  "T√¥i mu·ªën ngh·ªÅ nghi·ªáp c√≥ √≠ch cho x√£ h·ªôi.",
  "T√¥i coi tr·ªçng s·ª± s√°ng t·∫°o trong c√¥ng vi·ªác.",
  "T√¥i mu·ªën ngh·ªÅ nghi·ªáp gi√∫p t√¥i ph√°t tri·ªÉn b·∫£n th√¢n.",
  "T√¥i th√≠ch m√¥i tr∆∞·ªùng l√†m vi·ªác linh ho·∫°t.",
  "T√¥i coi tr·ªçng vi·ªác kh√¥ng ng·ª´ng h·ªçc h·ªèi.",
  "T√¥i mong mu·ªën ngh·ªÅ nghi·ªáp ph·∫£n √°nh gi√° tr·ªã c√° nh√¢n.",

  "T√¥i s·∫µn s√†ng h·ªçc t·∫≠p d√†i h·∫°n ƒë·ªÉ theo ƒëu·ªïi ngh·ªÅ ph√π h·ª£p.",
  "ƒêi·ªÅu ki·ªán t√†i ch√≠nh gia ƒë√¨nh cho ph√©p t√¥i h·ªçc t·∫≠p.",
  "Gia ƒë√¨nh ·ªßng h·ªô l·ª±a ch·ªçn ngh·ªÅ nghi·ªáp c·ªßa t√¥i.",
  "T√¥i s·∫µn s√†ng l·∫≠p k·∫ø ho·∫°ch ƒë·ªÉ theo ƒëu·ªïi ngh·ªÅ ƒë√£ ch·ªçn."
];

// Render c√¢u h·ªèi
const qDiv = document.getElementById("questions");
questions.forEach((q, i) => {
  const div = document.createElement("div");
  div.className = "question";
  div.innerHTML = `
    <div class="q-title">C√¢u ${i + 1}: ${q}</div>
    <div class="options">
      ${[1,2,3,4,5].map(v =>
        `<label><input type="radio" name="q${i}" value="${v}" required> ${v}</label>`
      ).join(" ")}
    </div>
  `;
  qDiv.appendChild(div);
});

// Submit b√†i
document.getElementById("quiz").onsubmit = async (e) => {
  e.preventDefault();

  const answers = [];
  for (let i = 0; i < 50; i++) {
    const checked = document.querySelector(`input[name="q${i}"]:checked`);
    if (!checked) {
      alert("B·∫°n ch∆∞a tr·∫£ l·ªùi ƒë·ªß 50 c√¢u.");
      return;
    }
    answers.push(parseInt(checked.value));
  }

  const payload = {
    name: document.getElementById("name").value.trim(),
    "class": document.getElementById("class").value.trim(),
    school: document.getElementById("school").value.trim(),
    answers_json: answers
  };
  
  // Validate form data
  if (!payload.name || !payload["class"] || !payload.school) {
    alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin (H·ªç t√™n, L·ªõp, Tr∆∞·ªùng).");
    return;
  }

  const resultBox = document.getElementById("result");
  resultBox.innerText = "‚è≥ H·ªá th·ªëng ƒëang ph√¢n t√≠ch k·∫øt qu·∫£ h∆∞·ªõng nghi·ªáp...";

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (!res.ok) {
      resultBox.innerText = "‚ùå L·ªói t·ª´ h·ªá th·ªëng:\n" + JSON.stringify(data, null, 2);
      return;
    }

    resultBox.innerText =
      data.data?.outputs?.text || "‚ùå Kh√¥ng nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£ t∆∞ v·∫•n.";

  } catch (err) {
    resultBox.innerText =
      "‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c t·ªõi h·ªá th·ªëng.\n" + 
      (err.message || "Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi Internet v√† th·ª≠ l·∫°i.");
  }
};
</script>

</body>
</html>
