<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CareerGo - H√†nh tr√¨nh h∆∞·ªõng nghi·ªáp s·ªë ‚Äì Kh√°m ph√° con ƒë∆∞·ªùng s·ª± nghi·ªáp c·ªßa b·∫°n</title>
  <style>
        :root {
    --primary-blue: #1371A8;
    --primary-orange: #E97423;
    --grey-dark: #2c3e50;
    --grey-light: #bdc3c7;
    --white: #ffffff;
    --transition: all 0.3s ease-in-out;
}

    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', 'Segoe UI', sans-serif;
}

    body {
      	background: linear-gradient(135deg, #1470a6 100%, #b0aeae 0%);
    	min-height: 100vh;
    	color: var(--white);
    	padding-bottom: 50px;
    }

    /* Score temp display */
    .score-temp {
      position: fixed;
      top: 80px;
      right: 20px;
      background: rgba(15, 31, 58, 0.95);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(77, 124, 255, 0.3);
      backdrop-filter: blur(10px);
      z-index: 100;
      display: none;
      /* Hidden by default */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      width: 200px;
    }

    .score-temp.active {
      display: block;
      animation: slideInRight 0.3s ease;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(20px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* ===== HEADER ===== */
    header {
    background: rgba(255, 255, 255, 0.98);
    padding: 10px 8%;        /* Gi·∫£m padding d·ªçc m·ªôt ch√∫t */
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    position: sticky;
    top: 0;
    z-index: 1000;
    }

.logo {
    display: flex;
    align-items: center;
    gap: 10px; /* Kho·∫£ng c√°ch n·∫±m gi·ªØa ·∫¢nh v√† to√†n b·ªô Ch·ªØ */
    text-decoration: none;
    font-size: 26px;
    font-weight: 800;
}

/* Career c√≥ m√†u xanh */
.logo-text {
    color: #1371A8;
    display: inline-block; /* ƒê·∫£m b·∫£o text kh√¥ng b·ªã t√°ch d√≤ng */
}

/* Go c√≥ m√†u cam v√† d√≠nh li·ªÅn v·ªõi Career */
.logo-text span {
    color: #E97423;
}

.logo-img {
    height: 40px;
    width: auto;
    object-fit: contain;
}

nav a {
    text-decoration: none;
    color: var(--grey-dark);
    font-weight: 600;
    margin-left: 20px;
    padding: 8px 16px;
    border-radius: 5px;
    transition: var(--transition);
}

/* Hi·ªáu ·ª©ng Hover cho Tab */
nav a:hover {
    background-color: var(--primary-blue);
    color: var(--white) !important;
    transform: translateY(-2px);
}

nav a.active {
    background-color: var(--primary-orange);
    color: var(--white);
}
/* 3. C√ÅC H·ªòP M√ÄU CAM C√ì ƒê·ªî B√ìNG */
.card {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin: 6rem 0;
    background-color: var(--primary-orange);
    color: var(--white); /* Ch·ªØ tr·∫Øng trong h·ªôp cam */
    padding: 30px;
    border-radius: 15px;
    border: 2px solid rgba(255,255,255,0.2);
    margin-bottom: 30px;
    /* Hi·ªáu ·ª©ng ƒë·ªï b√≥ng m·∫°nh */
    box-shadow: 0 10px 30px rgba(233, 116, 35, 0.4);
    transition: var(--transition);
}

.card:hover {
    transform: scale(1.01);
    box-shadow: 0 200px 600px rgba(233, 116, 35, 0.6);
}

.card h3 {
    color: var(--white); /* Ti√™u ƒë·ªÅ trong h·ªôp cam m√†u tr·∫Øng */
    margin-bottom: 20px;
    border-bottom: 2px solid rgba(255,255,255,0.3);
    padding-bottom: 10px;
}


    /* ===== LOADING MODAL ===== */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(4px);
    }

    .loading-overlay.active {
      display: flex;
    }

    .loading-modal {
      background: linear-gradient(135deg, #0b1220 0%, #0f1a33 100%);
      border: 1px solid rgba(26, 60, 255, 0.3);
      border-radius: 16px;
      padding: 3rem 2rem;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      max-width: 400px;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 4px solid rgba(26, 60, 255, 0.2);
      border-top: 4px solid #1a3cff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1.5rem;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      font-size: 1.1rem;
      color: #cfe0ff;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .loading-subtext {
      font-size: 0.9rem;
      color: #9fb7ff;
      margin-top: 0.5rem;
    }

    /* ===== MAIN CONTAINER ===== */
    .wrapper {
    max-width: 1000px;
    margin: 40px auto;
    padding: 0 20px;
}

    .page {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== LANDING PAGE ===== */
    .hero {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: center;
      min-height: calc(100vh - 80px);
      padding: 4rem 0;
    }

    .hero-content h1 {
      font-size: 3.5rem;
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, #fff, #cfe0ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-content p {
      font-size: 1.2rem;
      color: var(--white);
      margin-bottom: 2rem;
      line-height: 1.8;
    }

    .cta-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      max-width: 400px;
    }

    .btn {
      padding: 0.85rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #1a3cff, #1a3cff);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(26, 60, 255, 0.3);
    }

    .btn-secondary {
      background: transparent;
      border: 2px solid #2a3b66;
      color: #9fb7ff;
    }

    .btn-secondary:hover {
      border-color: #1a3cff;
      color: #cfe0ff;
    }

    .hero-visual {
      background: radial-gradient(circle at top right, rgba(26, 60, 255, 0.2), transparent);
      border-radius: 16px;
      border: 1px solid rgba(30, 42, 68, 0.5);
      padding: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 400px;
    }

    .icon-large {
      font-size: 6rem;
      opacity: 0.7;
    }
/*===== CHART ===== */
.labour-section {
  background: #ffffff;
  padding: 100px 40px;
}

.labour-container {
  max-width: 1200px;
  margin: auto;
}

.labour-container h2 {
  text-align: center;
  font-size: 26px;
  margin-bottom: 60px;
  color: #222;
}

.labour-container h2 span {
  font-size: 14px;
  color: #666;
}

/* ===== CHART LAYOUT ===== */
.labour-section {
  background:#fff;
  margin: 0 !important;
  padding-top: 20px !important;
  font-family:Arial, sans-serif;
}

.labour-container {
  max-width:1100px;
  margin:auto;
  text-align:center;
}

/* TITLE */
.chart-title {
  font-size:26px;
  margin-bottom: 2px !important;
  color:#000;
  line-height:1.2;
}

.chart-source {
  font-size:14px;
  color:#000;
  margin-bottom:25px !important;
  line-height:1.2;
}

.chart-source a {
  color:#000;
  text-decoration:underline;
}

/* LAYOUT */
.chart-wrapper {
  display:flex;
  justify-content:center;
  align-items:flex-end;
  gap:20px;
}

/* Y AXIS */
.y-axis {
  height:400px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  font-size:12px;
  color:#000;
}

/* CHART AREA */
.chart-area {
  position:relative;
  width:100%;
  max-width:900px;
  height:400px;
  border-left:2px solid #000;
  border-bottom:2px solid #000;
  background:
    repeating-linear-gradient(
      to top,
      transparent,
      transparent 49px,
      rgba(0,0,0,0.06) 50px
    );
}

/* BARS */
.bars {
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  justify-content:space-around;
  align-items:flex-end;
  height:100%;
}

.bar {
  width:45px;
  height:0;
  border-radius:6px 6px 0 0;
  position:relative;
  transition:height 1.2s ease-out, transform .2s ease;
  cursor:pointer;
}

/* Hover highlight */
.bar:hover {
  transform:translateY(-6px);
  filter:brightness(1.1);
  box-shadow:0 6px 12px rgba(0,0,0,0.15);
}

/* Percent */
.bar::after {
  content: attr(data-display);
  position:absolute;
  bottom:100%;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  font-weight:bold;
  color:#000;
  margin-bottom:4px;
}

/* Legend */
.legend {
  margin-top:40px;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:15px 40px;
  font-size:14px;
  color:#000;
}

.legend div {
  display:flex;
  align-items:center;
  gap:8px;
}

.legend span {
  width:14px;
  height:14px;
  border-radius:3px;
  display:inline-block;
}


   /* ===== FEATURES SECTION ===== */
    .features {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
      margin: 6rem 0;
    background-color: var(--primary-orange);
    color: var(--white); /* Ch·ªØ tr·∫Øng trong h·ªôp cam */
    padding: 30px;
    border-radius: 15px;
    border: 2px solid rgba(255,255,255,0.2);
    margin-bottom: 30px;
    /* Hi·ªáu ·ª©ng ƒë·ªï b√≥ng m·∫°nh */
    box-shadow: 0 10px 30px rgba(233, 116, 35, 0.4);
    transition: var(--transition);
    }

    .feature-card {
      background: var (--primary-blue);	/*rgba(15, 31, 58, 0.5)*/
      border: 1px solid rgba(30, 42, 68, 0.5);
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s;
    }

    .feature-card:hover {
      background: rgba(15, 31, 58, 0.8);
      border-color: rgba(26, 60, 255, 0.5);
    }

    .feature-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .feature-card h3 {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
    }

    .feature-card p {
      color: var(--white);
      font-size: 0.95rem;
    }

    /* ===== RIASEC TEST PAGE ===== */
    .test-container {
      max-width: 900px;
      margin: 3rem auto;
      padding-bottom: 4rem;
    }

    .progress-section {
      margin-bottom: 3rem;
    }

    .progress-bar {
      height: 8px;
      background: rgba(30, 42, 68, 0.5);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0.75rem;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #1a3cff, #4d7cff);
      width: 0%;
      transition: width 0.4s ease;
    }

    .progress-text {
      font-size: 0.9rem;
      color: #9fb7ff;
      display: flex;
      justify-content: space-between;
    }

    .test-section {
      background: rgba(15, 31, 58, 0.6);
      border: 1px solid rgba(30, 42, 68, 0.5);
      border-radius: 12px;
      padding: 2.5rem;
      margin-bottom: 2rem;
    }

    .test-section h2 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
      color: #fff;
    }

    .question-item {
      margin-bottom: 2.5rem;
    }

    .question-item label {
      display: block;
      font-weight: 500;
      margin-bottom: 1rem;
      color: #cfe0ff;
    }

    .answer-options {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.75rem;
    }

    .answer-option {
      position: relative;
    }

    .answer-option input[type="radio"] {
      display: none;
    }

    .answer-option label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem;
      border: 2px solid rgba(30, 42, 68, 0.5);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s;
      background: transparent;
      margin: 0;
    }

    .answer-option input[type="radio"]:checked+label {
      background: linear-gradient(135deg, #1a3cff, #1a3cff);
      border-color: #1a3cff;
      color: #fff;
    }

    .answer-option label:hover {
      border-color: #2a3b66;
      background: rgba(26, 60, 255, 0.1);
    }

    .scale-explanation {
      background: rgba(26, 60, 255, 0.1);
      border-left: 3px solid #1a3cff;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      font-size: 0.95rem;
    }

    .scale-legend {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
      margin-top: 1rem;
    }

    .scale-item {
      text-align: center;
      padding: 0.75rem;
      background: rgba(15, 31, 58, 0.8);
      border-radius: 6px;
      font-size: 0.85rem;
      color: #9fb7ff;
    }

    /* ===== RESULTS PAGE ===== */
    .results-container {
      max-width: 900px;
      margin: 3rem auto;
    }

    .result-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .result-header h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .riasec-badge {
      display: inline-block;
      background: linear-gradient(135deg, #1a3cff, #4d7cff);
      padding: 1rem 2rem;
      border-radius: 8px;
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 1rem;
    }

    .major-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .major-card {
      background: rgba(15, 31, 58, 0.6);
      border: 2px solid rgba(30, 42, 68, 0.5);
      border-radius: 12px;
      padding: 2rem;
      transition: all 0.3s;
    }

    .major-card:hover {
      border-color: #1a3cff;
      background: rgba(15, 31, 58, 0.9);
    }

    .major-card.rank-1 {
      border-color: #ffd700;
    }

    .major-card.rank-2 {
      border-color: #c0c0c0;
    }

    .major-card.rank-3 {
      border-color: #cd7f32;
    }

    .major-badge {
      display: inline-block;
      background: rgba(26, 60, 255, 0.2);
      border: 1px solid #1a3cff;
      color: #4d7cff;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .major-card h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .major-code {
      color: #9fb7ff;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .major-card p {
      color: #9fb7ff;
      font-size: 0.95rem;
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .match-badge {
      display: inline-block;
      background: #081225;
      border: 1px solid #2a3b66;
      color: #cfe0ff;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* ===== DASHBOARD ===== */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 2rem;
      margin: 3rem 0;
    }

    .dashboard-card {
      background: rgba(15, 31, 58, 0.6);
      border: 1px solid rgba(30, 42, 68, 0.5);
      border-radius: 12px;
      padding: 2rem;
    }

    .dashboard-card h3 {
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 1rem;
      background: rgba(8, 18, 37, 0.5);
      border-radius: 8px;
      margin-bottom: 0.75rem;
      border-left: 3px solid #1a3cff;
    }

    .stat-value {
      font-weight: 700;
      color: #1a3cff;
      font-size: 1.1rem;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .hero {
        grid-template-columns: 1fr;
        gap: 2rem;
        padding: 2rem 0;
      }

      .hero-content h1 {
        font-size: 2.5rem;
      }

      .features {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .answer-options {
        grid-template-columns: repeat(3, 1fr);
      }

      .scale-legend {
        grid-template-columns: repeat(3, 1fr);
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      nav {
        gap: 1rem;
      }

      nav a {
        font-size: 0.85rem;
      }
    }

    /* ===== UTILITY ===== */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #9fb7ff;
    }

    .badge {
      display: inline-block;
      background: rgba(26, 60, 255, 0.2);
      border: 1px solid #1a3cff;
      color: #4d7cff;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* ===== DEV MODE ONLY ===== */
    .dev-only {
      display: none !important;
    }

    /* Only show nav links inline */
    .dev-mode a.dev-only,
    .dev-mode button.dev-only {
      display: inline-block !important;
    }

    /* Sections work normally (hidden by default, block when active) */
    .dev-mode section.dev-only.active {
      display: block !important;
    }

    /* Health Page Styles */
    .health-card {
      background: rgba(15, 31, 58, 0.8);
      border: 1px solid rgba(26, 60, 255, 0.3);
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      max-width: 600px;
      margin: 2rem auto;
    }

    .status-indicator {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .status-ok {
      color: #4ade80;
    }

    .status-error {
      color: #f87171;
    }
  </style>
</head>

<body>

  <!-- LOADING MODAL -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-modal">
      <div class="spinner"></div>
      <div class="loading-text">ü§ñ AI ƒëang suy nghƒ©...</div>
      <div class="loading-subtext">Vui l√≤ng ch·ªù khi AI ph√¢n t√≠ch h·ªì s∆° c·ªßa b·∫°n</div>
    </div>
  </div>

  <!-- HEADER -->
  <header>
    <div class="logo">
    	<span class="logo-text">Career<span>Go</span></span>
    </div>
    <nav>
      <a href="#" data-page="landing" class="nav-link active">Trang ch·ªß</a>
      <a href="#" data-page="test" class="nav-link">RIASEC Test</a>
      <a href="#" data-page="results" class="nav-link">K·∫øt qu·∫£</a>
      <a href="#" data-page="chatbot" class="nav-link">üí¨ AI Chatbot</a>
      <a href="#" data-page="vr-mode" class="nav-link">Tr·∫£i nghi·ªám ngh·ªÅ nghi·ªáp</a>
      <a href="#" data-page="dashboard" class="nav-link">Th·ªëng k√™</a>
      <a href="#" data-page="health" class="nav-link dev-only">üè• Health</a>
      <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.2); margin: 0 0.5rem;"></div>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <div class="wrapper">

    <!-- LANDING PAGE -->
    <section class="page active" id="landing">
      <div class="hero">
        <div class="hero-content">
          <p
            style="color: var(--primary-orange); font-weight: 800; margin-bottom: 0.5rem; letter-spacing: 0.1px; text-transform: uppercase;">
            CareerGo - H√†nh tr√¨nh h∆∞·ªõng nghi·ªáp s·ªë</p>
          <h1>Kh√°m ph√° con ƒë∆∞·ªùng s·ª± nghi·ªáp c·ªßa b·∫°n</h1>
          <p>S·ª≠ d·ª•ng tr·∫Øc nghi·ªám RIASEC ƒë∆∞·ª£c c√° nh√¢n h√≥a ƒë·ªÉ t√¨m hi·ªÉu v·ªÅ nh·ªØng ng√†nh ngh·ªÅ ph√π h·ª£p nh·∫•t v·ªõi b·∫°n. Tr·∫£i
            nghi·ªám Ngh·ªÅ nghi·ªáp v√† nh·∫≠n l·ªùi khuy√™n t·ª´ AI.</p>
          <div class="cta-group">
            <button class="btn btn-primary" onclick="goPage('test')">B·∫Øt ƒë·∫ßu tr·∫Øc nghi·ªám</button>
            <button class="btn btn-secondary" onclick="goPage('dashboard')">Xem th·ªëng k√™</button>
          </div>
        </div>
        <img src="static/background.png"
          style="width: 100%; height: auto; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);"
          alt="CareerGo Banner">
      </div>

      <div class="features">
        <div class="feature-card">
          <div class="feature-icon">üìä</div>
          <h3>RIASEC Test</h3>
          <p>50 c√¢u h·ªèi khoa h·ªçc ƒë·ªÉ ƒë√°nh gi√° s·ªü th√≠ch, k·ªπ nƒÉng, v√† t√≠nh c√°ch c·ªßa b·∫°n</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ü•Ω</div>
          <h3>Tr·∫£i nghi·ªám ngh·ªÅ nghi·ªáp</h3>
          <p>Kh√°m ph√° c√°c ng√†nh ngh·ªÅ qua tr·ª±c quan h√≥a VR t∆∞∆°ng t√°c</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ü§ñ</div>
          <h3>T∆∞ v·∫•n AI</h3>
          <p>Chatbot th√¥ng minh gi√∫p b·∫°n tr·∫£ l·ªùi m·ªçi c√¢u h·ªèi v·ªÅ h·ªô s·ª± nghi·ªáp</p>
        </div>
      </div>
    </section>

<!-- ===== LABOUR MARKET SECTION ===== -->
<section class="labour-section">
  <div class="labour-container">

    <h2 class="chart-title">
      Th·ªã tr∆∞·ªùng lao ƒë·ªông Vi·ªát Nam 9 th√°ng ƒë·∫ßu nƒÉm 2025
    </h2>

    <p class="chart-source">
      (Theo s·ªë li·ªáu c·ªßa c∆° quan th·ªëng k√™ qu·ªëc gia 
      <a href="https://www.nso.gov.vn/" target="_blank">
        https://www.nso.gov.vn/
      </a>)
    </p>

    <div class="chart-wrapper">

      <!-- Y AXIS -->
      <div class="y-axis">
        <span>80%</span>
        <span>70%</span>
        <span>60%</span>
        <span>50%</span>
        <span>40%</span>
        <span>30%</span>
        <span>20%</span>
        <span>10%</span>
        <span>0%</span>
      </div>

      <!-- CHART AREA -->
      <div class="chart-area">
        <div class="bars">

          <div class="bar" data-value="68.4" style="background:#1f77b4;"></div>
          <div class="bar" data-value="29.1" style="background:#ff7f0e;"></div>
          <div class="bar" data-value="63.4" style="background:#2ca02c;"></div>
          <div class="bar" data-value="1.65" style="background:#d62728;"></div>
          <div class="bar" data-value="2.22" style="background:#9467bd;"></div>
          <div class="bar" data-value="8.38" style="background:#8c564b;"></div>
          <div class="bar" data-value="3.7" style="background:#e377c2;"></div>

        </div>
      </div>

    </div>

    <!-- LEGEND -->
    <div class="legend">
      <div><span style="background:#1f77b4"></span> Tham gia l·ª±c l∆∞·ª£ng lao ƒë·ªông</div>
      <div><span style="background:#ff7f0e"></span> Lao ƒë·ªông qua ƒë√†o t·∫°o</div>
      <div><span style="background:#2ca02c"></span> Lao ƒë·ªông phi ch√≠nh th·ª©c</div>
      <div><span style="background:#d62728"></span> Thi·∫øu vi·ªác l√†m</div>
      <div><span style="background:#9467bd"></span> Th·∫•t nghi·ªáp (ƒë·ªô tu·ªïi Lƒê)</div>
      <div><span style="background:#8c564b"></span> Th·∫•t nghi·ªáp lao ƒë·ªông tr·∫ª</div>
      <div><span style="background:#e377c2"></span> Kh√¥ng s·ª≠ d·ª•ng h·∫øt ti·ªÅm nƒÉng</div>
    </div>

  </div>
</section>

    <!-- DASHBOARD PAGE (Duplicate removed) -->

    <!-- HEALTH PAGE (DEV ONLY) -->
    <section id="health" class="page wrapper dev-only">
      <div class="card test-section">
        <h2 style="text-align: center; margin-bottom: 1rem;">üè• System Health</h2>
        <div id="healthContent" class="health-card">
          <div class="spinner"></div>
          <p>Checking system status...</p>
        </div>
      </div>
    </section>

    <!-- TEST PAGE -->
    <section class="page" id="test">
      <div class="test-container">
        <h1 style="text-align: center; margin-bottom: 3rem;">Tr·∫Øc nghi·ªám RIASEC</h1>

        <!-- Info input -->

        <div class="features">
          <h2 style="font-size: 1.25rem;">Th√¥ng tin c√° nh√¢n</h2>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div>
              <label for="name">H·ªç v√† t√™n</label>
              <input type="text" id="name" placeholder="Nguy·ªÖn VƒÉn A"
                style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
            </div>
            <div>
              <label for="class">L·ªõp</label>
              <input type="text" id="class" placeholder="10A1"
                style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
            </div>
            <div>
              <label for="school">Tr∆∞·ªùng</label>
              <input type="text" id="school" placeholder="THPT ..."
                style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
            </div>
          </div>
        </div>

        <!-- Progress -->
        <div class="progress-section">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
          </div>
          <div class="progress-text">
            <span id="progressText">0 / 50 c√¢u</span>
            <span id="estimatedTime">~10 ph√∫t</span>
          </div>
        </div>

        <!-- Scale explanation -->
        <div class="scale-explanation">
          <strong>H∆∞·ªõng d·∫´n tr·∫£ l·ªùi:</strong> V·ªõi m·ªói c√¢u h·ªèi, h√£y ƒë√°nh gi√° t·ª´ 1 (R·∫•t kh√¥ng ƒë√∫ng) ƒë·∫øn 5 (R·∫•t ƒë√∫ng)
          <div class="scale-legend">
            <div class="scale-item">1Ô∏è‚É£ R·∫•t kh√¥ng ƒë√∫ng</div>
            <div class="scale-item">2Ô∏è‚É£ Kh√¥ng ƒë√∫ng</div>
            <div class="scale-item">3Ô∏è‚É£ Ph√¢n v√¢n</div>
            <div class="scale-item">4Ô∏è‚É£ ƒê√∫ng</div>
            <div class="scale-item">5Ô∏è‚É£ R·∫•t ƒë√∫ng</div>
          </div>
        </div>

        <!-- Questions form -->
        <form id="testForm">
          <div id="questionsContainer"></div>
          <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center; flex-wrap: wrap;">
            <button type="button" onclick="submitTest()" class="btn btn-primary"
              style="padding: 0.8rem 2rem; font-size: 1.1rem;">üöÄ N·ªôp b√†i & Xem k·∫øt qu·∫£</button>
            <button type="button" class="btn btn-secondary" onclick="resetTest()">L√†m l·∫°i</button>
            <button type="button" id="btnDevFill" class="btn btn-secondary"
              style="border-color: #ffd700; color: #ffd700; display: none;" onclick="devAutoFill()">‚ö° Dev Fill</button>
          </div>
        </form>
      </div>
    </section>

    <!-- RESULTS PAGE -->
    <section class="page" id="results">
      <div class="results-container">
        <div class="result-header">
          <h1>K·∫øt qu·∫£ c·ªßa b·∫°n</h1>
          <div class="riasec-badge" id="riasecDisplay">RAI</div>

          <!-- New Score Display -->
          <div id="scoreDetails"
            style="max-width: 600px; margin: 0 auto 2rem auto; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <!-- Scores will be injected here -->
          </div>

          <p id="resultTime" style="color: #9fb7ff; margin-top: 1rem;">-</p>
        </div>

        <h2 style="margin: 2rem 0 1.5rem 0;">C√°c ng√†nh g·ª£i √Ω</h2>
        <div class="major-grid" id="majorContainer"></div>

        <div style="text-align: center; margin-top: 3rem;">
          <button class="btn btn-primary" onclick="goPage('test')">L√†m l·∫°i tr·∫Øc nghi·ªám</button>
        </div>
      </div>
    </section>

    <!-- CHATBOT PAGE -->
    <section class="page" id="chatbot">
      <div style="max-width: 900px; margin: 2rem auto; padding-bottom: 4rem;">
        <h1 style="text-align: center; margin-bottom: 2rem;">üí¨ T∆∞ v·∫•n AI h∆∞·ªõng nghi·ªáp</h1>

        <!-- Context card -->
        <div class="test-section"
          style="background: rgba(26, 60, 255, 0.1); border-color: rgba(26, 60, 255, 0.3); margin-bottom: 2rem;">
          <h3 style="margin-top: 0;">üìã H·ªì s∆° c·ªßa b·∫°n</h3>
          <div id="chatContext" style="color: #9fb7ff;">Ch∆∞a c√≥ d·ªØ li·ªáu. Vui l√≤ng l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc.</div>
        </div>

        <!-- Chat UI -->
        <div id="chatContainer"
          style="border: 1px solid rgba(30, 42, 68, 0.5); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; height: 700px; background: rgba(8, 18, 37, 0.8);">
          <!-- Messages -->
          <div id="messagesBox"
            style="flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
            <div style="color: #9fb7ff; font-size: 0.9rem;">
              <strong>ü§ñ AI:</strong> Xin ch√†o! T√¥i s·∫µn s√†ng t∆∞ v·∫•n cho b·∫°n d·ª±a tr√™n k·∫øt qu·∫£ RIASEC. Nh·∫•n n√∫t "Y√™u c·∫ßu
              t∆∞ v·∫•n" b√™n d∆∞·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu.
            </div>
          </div>

          <!-- Input area -->
          <div style="border-top: 1px solid rgba(30, 42, 68, 0.5); padding: 1rem; display: flex; gap: 0.75rem;">
            <input type="text" id="chatInput" placeholder="H·ªèi AI v·ªÅ h∆∞·ªõng nghi·ªáp c·ªßa b·∫°n..."
              style="flex: 1; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
            <button class="btn btn-primary" onclick="sendChatMessage()" style="padding: 0.75rem 1.5rem;">G·ª≠i</button>
          </div>
        </div>

        <!-- Action buttons -->
        <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap; justify-content: center;">
          <button class="btn btn-primary" id="consultBtn" onclick="requestCounsel()">‚ú® Y√™u c·∫ßu t∆∞ v·∫•n</button>
          <button class="btn btn-secondary" onclick="goPage('results')">‚Üê Quay l·∫°i k·∫øt qu·∫£</button>
        </div>

        <div id="loadingIndicator" style="text-align: center; color: #9fb7ff; margin-top: 1rem; display: none;">
          <span>‚è≥ ƒêang ch·ªù AI ph·∫£n h·ªìi...</span>
        </div>
      </div>
    </section>


    <!-- VR EXPERIENCE PAGE -->
    <section class="page" id="vr-mode">
      <h1 style="text-align: center; margin-bottom: 2rem;">Tr·∫£i nghi·ªám Ngh·ªÅ nghi·ªáp</h1>
      <p
        style="text-align: center; margin-bottom: 2rem; color: #9fb7ff; max-width: 700px; margin-left: auto; margin-right: auto;">
        Kh√°m ph√° m√¥i tr∆∞·ªùng l√†m vi·ªác th·ª±c t·∫ø qua c√°c video m√¥ ph·ªèng ngh·ªÅ nghi·ªáp. Ch·ªçn m·ªôt ngh·ªÅ ƒë·ªÉ tr·∫£i nghi·ªám!
      </p>

      <!-- VR Controls (Admin/Dev) -->
      <div id="vrControls" style="text-align: center; margin-bottom: 2rem; display: none;">
        <div id="devTools" style="display: none; margin-top: 1rem; gap: 1rem; justify-content: center;">
          <button class="btn btn-primary" onclick="addNewVRJob()" style="padding: 0.5rem 1rem; font-size: 0.9rem;">+
            Th√™m ngh·ªÅ m·ªõi</button>
          <button class="btn btn-secondary" onclick="resetVRData()"
            style="padding: 0.5rem 1rem; font-size: 0.9rem; border-color: #ffd700; color: #ffd700;">‚ö° Dev Fill
            (Reset)</button></a>
        </div>
      </div>

      <!-- VR Grid Container -->
      <div id="vrGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
        <!-- Dynamic content will be loaded here -->
      </div>
    </section>

    <!-- VIDEO MODAL -->
    <div id="videoModal" class="loading-overlay" onclick="closeVideoModal(event)">
      <div class="loading-modal" style="width: 90%; max-width: 900px; padding: 1rem; background: #0b1220;">
        <div style="text-align: right; margin-bottom: 0.5rem;">
          <button onclick="closeVideoModal()"
            style="background: transparent; border: none; color: #fff; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>
        <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px;">
          <iframe id="videoFrame" src="" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
        </div>
        <h3 id="videoTitle" style="margin-top: 1rem; color: #4d7cff;"></h3>
      </div>
    </div>

    <!-- DEV EDITOR MODAL -->
    <div id="devJobModal" class="loading-overlay">
      <div class="loading-modal"
        style="width: 90%; max-width: 500px; padding: 2rem; background: #0b1220; text-align: left;">
        <h2 style="margin-bottom: 1.5rem; text-align: center; color: #ffd700;">üõ†Ô∏è Ch·ªânh s·ª≠a Video VR</h2>

        <input type="hidden" id="devJobId">

        <div style="margin-bottom: 1rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #9fb7ff;">Ti√™u ƒë·ªÅ:</label>
          <input type="text" id="devJobTitle"
            style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #9fb7ff;">YouTube Video ID:</label>
          <input type="text" id="devJobVideoId" placeholder="VD: BZgv0k_0IQs"
            style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
        </div>

        <div style="margin-bottom: 1rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #9fb7ff;">M√¥ t·∫£:</label>
          <textarea id="devJobDesc" rows="3"
            style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;"></textarea>
        </div>

        <div style="margin-bottom: 2rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #9fb7ff;">Icon (Emoji):</label>
          <input type="text" id="devJobIcon" placeholder="üé•"
            style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #2a3b66; background: #081225; color: #fff;">
        </div>

        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
          <button onclick="closeDevModal()" class="btn btn-secondary"
            style="border-color: #ff4d4f; color: #ff4d4f;">H·ªßy</button>
          <button onclick="saveDevJob()" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
        </div>
      </div>
    </div>

    <!-- DASHBOARD -->
    <section class="page" id="dashboard">
      <h1 style="margin-top: 3rem; margin-bottom: 2rem;">Th·ªëng k√™ & Qu·∫£n l√Ω d·ªØ li·ªáu</h1>
      <div id="dashboardContent"></div>
      <div style="text-align: center; margin-top: 3rem; margin-bottom: 3rem;">
        <button id="btnClearData" class="btn btn-secondary" onclick="clearAllData()" style="display: none;">Xo√° t·∫•t c·∫£
          d·ªØ li·ªáu</button>
      </div>
    </section>

  </div>

  <script>
    // ===== CONFIG & CONSTANTS =====
    const DB_KEY = 'careerVR_records';
    const RIASEC_KEY = 'careerVR_current';

    // RIASEC questions (50 total)
    const RIASEC_QUESTIONS = [
      // R ‚Äì REALISTIC (1-4)
      { q: "T√¥i th√≠ch s·ª≠a ch·ªØa, l·∫Øp r√°p ƒë·ªì ƒë·∫°c ho·∫∑c thi·∫øt b·ªã.", r: "R" },
      { q: "T√¥i h·ª©ng th√∫ v·ªõi c√°c c√¥ng vi·ªác c·∫ßn v·∫≠n ƒë·ªông ho·∫∑c l√†m ngo√†i tr·ªùi.", r: "R" },
      { q: "T√¥i th√≠ch l√†m vi·ªác v·ªõi c√¥ng c·ª•, m√°y m√≥c h∆°n l√† gi·∫•y t·ªù.", r: "R" },
      { q: "T√¥i h·ªçc t·ªët h∆°n khi ƒë∆∞·ª£c l√†m tr·ª±c ti·∫øp thay v√¨ ch·ªâ nghe gi·∫£ng.", r: "R" },
      // I ‚Äì INVESTIGATIVE (5-8)
      { q: "T√¥i th√≠ch t√¨m hi·ªÉu nguy√™n nh√¢n ‚Äì k·∫øt qu·∫£ c·ªßa m·ªôt v·∫•n ƒë·ªÅ.", r: "I" },
      { q: "T√¥i th√≠ch c√°c m√¥n h·ªçc c·∫ßn suy lu·∫≠n nh∆∞ To√°n, L√Ω, H√≥a.", r: "I" },
      { q: "T√¥i th∆∞·ªùng ƒë·∫∑t c√¢u h·ªèi \"v√¨ sao\" khi h·ªçc ki·∫øn th·ª©c m·ªõi.", r: "I" },
      { q: "T√¥i th√≠ch ph√¢n t√≠ch d·ªØ li·ªáu, th√≠ nghi·ªám ho·∫∑c nghi√™n c·ª©u.", r: "I" },
      // A ‚Äì ARTISTIC (9-12)
      { q: "T√¥i th√≠ch v·∫Ω, vi·∫øt, thi·∫øt k·∫ø ho·∫∑c s√°ng t·∫°o n·ªôi dung.", r: "A" },
      { q: "T√¥i kh√¥ng th√≠ch c√¥ng vi·ªác qu√° khu√¥n m·∫´u, l·∫∑p l·∫°i.", r: "A" },
      { q: "T√¥i th√≠ch th·ªÉ hi·ªán √Ω t∆∞·ªüng v√† c·∫£m x√∫c c√° nh√¢n.", r: "A" },
      { q: "T√¥i h·ª©ng th√∫ v·ªõi √¢m nh·∫°c, m·ªπ thu·∫≠t ho·∫∑c truy·ªÅn th√¥ng.", r: "A" },
      // S ‚Äì SOCIAL (13-16)
      { q: "T√¥i th√≠ch gi√∫p ƒë·ª°, h∆∞·ªõng d·∫´n ho·∫∑c h·ªó tr·ª£ ng∆∞·ªùi kh√°c.", r: "S" },
      { q: "T√¥i c·∫£m th·∫•y vui khi l√†m vi·ªác nh√≥m.", r: "S" },
      { q: "T√¥i c√≥ xu h∆∞·ªõng l·∫Øng nghe v√† chia s·∫ª v·ªõi m·ªçi ng∆∞·ªùi.", r: "S" },
      { q: "T√¥i th√≠ch c√°c c√¥ng vi·ªác li√™n quan ƒë·∫øn gi√°o d·ª•c, y t·∫ø ho·∫∑c x√£ h·ªôi.", r: "S" },
      // E ‚Äì ENTERPRISING (17-20)
      { q: "T√¥i th√≠ch l√£nh ƒë·∫°o ho·∫∑c thuy·∫øt ph·ª•c ng∆∞·ªùi kh√°c.", r: "E" },
      { q: "T√¥i h·ª©ng th√∫ v·ªõi kinh doanh, b√°n h√†ng ho·∫∑c t·ªï ch·ª©c ho·∫°t ƒë·ªông.", r: "E" },
      { q: "T√¥i t·ª± tin khi tr√¨nh b√†y √Ω ki·∫øn tr∆∞·ªõc ƒë√°m ƒë√¥ng.", r: "E" },
      { q: "T√¥i th√≠ch ƒë·∫∑t m·ª•c ti√™u v√† chinh ph·ª•c k·∫øt qu·∫£.", r: "E" },
      // C ‚Äì CONVENTIONAL (21-24)
      { q: "T√¥i th√≠ch c√¥ng vi·ªác r√µ r√†ng, c√≥ quy tr√¨nh c·ª• th·ªÉ.", r: "C" },
      { q: "T√¥i c·∫©n th·∫≠n v·ªõi s·ªë li·ªáu, h·ªì s∆° v√† gi·∫•y t·ªù.", r: "C" },
      { q: "T√¥i th√≠ch l√†m vi·ªác c√≥ k·∫ø ho·∫°ch, th·ªùi gian bi·ªÉu r√µ r√†ng.", r: "C" },
      { q: "T√¥i c·∫£m th·∫•y y√™n t√¢m khi m·ªçi vi·ªác ƒë∆∞·ª£c s·∫Øp x·∫øp g·ªçn g√†ng.", r: "C" },
      // NƒÇNG L·ª∞C & K·ª∏ NƒÇNG (25-38)
      { q: "T√¥i h·ªçc t·ªët h∆°n khi ƒë∆∞·ª£c th·ª±c h√†nh, thao t√°c tr·ª±c ti·∫øp.", r: "R" },
      { q: "T√¥i h·ªçc t·ªët c√°c m√¥n c·∫ßn t∆∞ duy logic v√† ph√¢n t√≠ch.", r: "I" },
      { q: "T√¥i s·ª≠ d·ª•ng m√°y t√≠nh v√† ph·∫ßn m·ªÅm h·ªçc t·∫≠p m·ªôt c√°ch hi·ªáu qu·∫£.", r: "E" },
      { q: "T√¥i giao ti·∫øp v√† tr√¨nh b√†y √Ω ki·∫øn kh√° t·ª± tin.", r: "S" },
      { q: "T√¥i l√†m t·ªët c√°c c√¥ng vi·ªác c·∫ßn thao t√°c tay ho·∫∑c k·ªπ thu·∫≠t.", r: "R" },
      { q: "T√¥i ti·∫øp thu nhanh khi ƒë∆∞·ª£c quan s√°t v√† l√†m th·ª≠.", r: "R" },
      { q: "T√¥i c√≥ kh·∫£ nƒÉng ph√¢n t√≠ch v·∫•n ƒë·ªÅ v√† t√¨m c√°ch gi·∫£i quy·∫øt.", r: "I" },
      { q: "T√¥i th√≠ch c√°c nhi·ªám v·ª• c·∫ßn suy lu·∫≠n, t√≠nh to√°n.", r: "I" },
      { q: "T√¥i c√≥ kh·∫£ nƒÉng s√°ng t·∫°o √Ω t∆∞·ªüng m·ªõi.", r: "A" },
      { q: "T√¥i th∆∞·ªùng c√≥ c√°ch l√†m ri√™ng, kh√¥ng th√≠ch b·ªã b√≥ bu·ªôc.", r: "A" },
      { q: "T√¥i c√≥ kh·∫£ nƒÉng l·∫Øng nghe v√† h·ªó tr·ª£ ng∆∞·ªùi kh√°c.", r: "S" },
      { q: "T√¥i c·∫£m th·∫•y tho·∫£i m√°i khi l√†m vi·ªác nh√≥m.", r: "S" },
      { q: "T√¥i t·ª± tin ƒë∆∞a ra √Ω ki·∫øn v√† d·∫´n d·∫Øt nh√≥m.", r: "E" },
      { q: "T√¥i l√†m vi·ªác hi·ªáu qu·∫£ khi c√≥ k·∫ø ho·∫°ch r√µ r√†ng.", r: "C" },
      // GI√Å TR·ªä NGH·ªÄ NGHI·ªÜP (39-46)
      { q: "T√¥i coi tr·ªçng vi·ªác ngh·ªÅ nghi·ªáp mang l·∫°i thu nh·∫≠p v√† c∆° h·ªôi thƒÉng ti·∫øn.", r: "E" },
      { q: "T√¥i mong mu·ªën c√¥ng vi·ªác ·ªïn ƒë·ªãnh, l√¢u d√†i.", r: "C" },
      { q: "T√¥i mu·ªën ngh·ªÅ nghi·ªáp c√≥ √≠ch cho x√£ h·ªôi v√† c·ªông ƒë·ªìng.", r: "S" },
      { q: "T√¥i coi tr·ªçng s·ª± s√°ng t·∫°o trong c√¥ng vi·ªác.", r: "A" },
      { q: "T√¥i mu·ªën ngh·ªÅ nghi·ªáp gi√∫p t√¥i ph√°t tri·ªÉn b·∫£n th√¢n.", r: "I" },
      { q: "T√¥i th√≠ch m√¥i tr∆∞·ªùng l√†m vi·ªác linh ho·∫°t, kh√¥ng g√≤ b√≥.", r: "A" },
      { q: "T√¥i coi tr·ªçng vi·ªác kh√¥ng ng·ª´ng h·ªçc h·ªèi v√† n√¢ng cao ki·∫øn th·ª©c.", r: "C" },
      { q: "T√¥i mong mu·ªën c√¥ng vi·ªác ph·∫£n √°nh gi√° tr·ªã c√° nh√¢n v√† c√≥ √Ω nghƒ©a.", r: "E" },
      // ƒêI·ªÄU KI·ªÜN TH·ª∞C T·∫æ (47-50)
      { q: "T√¥i s·∫µn s√†ng h·ªçc t·∫≠p d√†i h·∫°n ƒë·ªÉ theo ƒëu·ªïi ngh·ªÅ ph√π h·ª£p.", r: "I" },
      { q: "ƒêi·ªÅu ki·ªán t√†i ch√≠nh gia ƒë√¨nh cho ph√©p t√¥i h·ªçc t·∫≠p c√≥ k·∫ø ho·∫°ch.", r: "C" },
      { q: "Gia ƒë√¨nh ·ªßng h·ªô v√† t√¥n tr·ªçng l·ª±a ch·ªçn ngh·ªÅ nghi·ªáp c·ªßa t√¥i.", r: "S" },
      { q: "T√¥i s·∫µn s√†ng l·∫≠p k·∫ø ho·∫°ch c·ª• th·ªÉ ƒë·ªÉ theo ƒëu·ªïi ngh·ªÅ ƒë√£ ch·ªçn.", r: "E" }
    ];

    // FULL 100-JOB MATRIX
    const MAJORS_DB = [
      // K·ª∏ THU·∫¨T ‚Äì C√îNG NGHI·ªÜP ‚Äì C√îNG NGH·ªÜ
      { name: "K·ªπ s∆∞ C∆° kh√≠", code: "R-I-C", group: "K·ªπ thu·∫≠t" },
      { name: "K·ªπ s∆∞ ƒêi·ªán ‚Äì ƒêi·ªán t·ª≠", code: "R-I-C", group: "K·ªπ thu·∫≠t" },
      { name: "K·ªπ s∆∞ T·ª± ƒë·ªông h√≥a", code: "R-I-C", group: "K·ªπ thu·∫≠t" },
      { name: "K·ªπ s∆∞ X√¢y d·ª±ng", code: "R-I-C", group: "K·ªπ thu·∫≠t" },
      { name: "K·ªπ s∆∞ Giao th√¥ng", code: "R-I-C", group: "K·ªπ thu·∫≠t" },
      { name: "K·ªπ s∆∞ M√¥i tr∆∞·ªùng", code: "I-R-S", group: "K·ªπ thu·∫≠t" },
      { name: "K·ªπ thu·∫≠t vi√™n C∆° ƒëi·ªán", code: "R-C-I", group: "K·ªπ thu·∫≠t" },
      { name: "C√¥ng ngh·ªá v·∫≠t li·ªáu", code: "I-R-C", group: "K·ªπ thu·∫≠t" },
      { name: "C√¥ng ngh·ªá √¥ t√¥", code: "R-I-C", group: "K·ªπ thu·∫≠t" },
      { name: "C√¥ng ngh·ªá k·ªπ thu·∫≠t nhi·ªát", code: "R-I-C", group: "K·ªπ thu·∫≠t" },

      // CNTT ‚Äì CHUY·ªÇN ƒê·ªîI S·ªê
      { name: "C√¥ng ngh·ªá th√¥ng tin", code: "I-R-C", group: "CNTT" },
      { name: "Khoa h·ªçc m√°y t√≠nh", code: "I-R-C", group: "CNTT" },
      { name: "K·ªπ thu·∫≠t ph·∫ßn m·ªÅm", code: "I-R-C", group: "CNTT" },
      { name: "An to√†n th√¥ng tin", code: "I-R-C", group: "CNTT" },
      { name: "Tr√≠ tu·ªá nh√¢n t·∫°o", code: "I-R-C", group: "CNTT" },
      { name: "Khoa h·ªçc d·ªØ li·ªáu", code: "I-R-C", group: "CNTT" },
      { name: "L·∫≠p tr√¨nh vi√™n", code: "I-R-C", group: "CNTT" },
      { name: "Qu·∫£n tr·ªã m·∫°ng", code: "R-I-C", group: "CNTT" },
      { name: "Ph√¢n t√≠ch d·ªØ li·ªáu", code: "I-C-R", group: "CNTT" },
      { name: "Thi·∫øt k·∫ø UI/UX", code: "A-I-C", group: "CNTT" },

      // KHOA H·ªåC ‚Äì Y SINH ‚Äì M√îI TR∆Ø·ªúNG
      { name: "Y ƒëa khoa", code: "I-S-R", group: "Y Sinh" },
      { name: "ƒêi·ªÅu d∆∞·ª°ng", code: "S-I-R", group: "Y Sinh" },
      { name: "D∆∞·ª£c h·ªçc", code: "I-C-R", group: "Y Sinh" },
      { name: "X√©t nghi·ªám y h·ªçc", code: "I-R-C", group: "Y Sinh" },
      { name: "C√¥ng ngh·ªá sinh h·ªçc", code: "I-R-C", group: "Y Sinh" },
      { name: "Khoa h·ªçc m√¥i tr∆∞·ªùng", code: "I-R-S", group: "Y Sinh" },
      { name: "K·ªπ thu·∫≠t y sinh", code: "I-R-C", group: "Y Sinh" },
      { name: "Th√∫ y", code: "I-R-S", group: "Y Sinh" },
      { name: "Dinh d∆∞·ª°ng", code: "I-S-C", group: "Y Sinh" },
      { name: "Y t·∫ø c√¥ng c·ªông", code: "S-I-C", group: "Y Sinh" },

      // GI√ÅO D·ª§C ‚Äì X√É H·ªòI
      { name: "S∆∞ ph·∫°m To√°n", code: "S-I-C", group: "Gi√°o d·ª•c" },
      { name: "S∆∞ ph·∫°m Ng·ªØ vƒÉn", code: "S-A-C", group: "Gi√°o d·ª•c" },
      { name: "S∆∞ ph·∫°m Ti·∫øng Anh", code: "S-A-C", group: "Gi√°o d·ª•c" },
      { name: "Gi√°o d·ª•c m·∫ßm non", code: "S-A-C", group: "Gi√°o d·ª•c" },
      { name: "C√¥ng t√°c x√£ h·ªôi", code: "S-I-A", group: "X√£ h·ªôi" },
      { name: "T√¢m l√Ω h·ªçc", code: "I-S-A", group: "X√£ h·ªôi" },
      { name: "X√£ h·ªôi h·ªçc", code: "I-S-C", group: "X√£ h·ªôi" },
      { name: "Qu·∫£n l√Ω gi√°o d·ª•c", code: "S-E-C", group: "Gi√°o d·ª•c" },
      { name: "Gi√°o d·ª•c ƒë·∫∑c bi·ªát", code: "S-I-A", group: "Gi√°o d·ª•c" },
      { name: "H∆∞·ªõng nghi·ªáp ‚Äì tham v·∫•n", code: "S-I-A", group: "Gi√°o d·ª•c" },

      // NGH·ªÜ THU·∫¨T ‚Äì TRUY·ªÄN TH√îNG
      { name: "Thi·∫øt k·∫ø ƒë·ªì h·ªça", code: "A-C-I", group: "Ngh·ªá thu·∫≠t" },
      { name: "Truy·ªÅn th√¥ng ƒëa ph∆∞∆°ng ti·ªán", code: "A-E-S", group: "Truy·ªÅn th√¥ng" },
      { name: "B√°o ch√≠", code: "A-S-E", group: "Truy·ªÅn th√¥ng" },
      { name: "Quan h·ªá c√¥ng ch√∫ng", code: "E-S-A", group: "Truy·ªÅn th√¥ng" },
      { name: "Marketing", code: "E-A-C", group: "Kinh t·∫ø" },
      { name: "Qu·∫£ng c√°o", code: "A-E-S", group: "Truy·ªÅn th√¥ng" },
      { name: "S·∫£n xu·∫•t phim", code: "A-E-S", group: "Ngh·ªá thu·∫≠t" },
      { name: "Nhi·∫øp ·∫£nh", code: "A-R-C", group: "Ngh·ªá thu·∫≠t" },
      { name: "√Çm nh·∫°c", code: "A-R-S", group: "Ngh·ªá thu·∫≠t" },
      { name: "M·ªπ thu·∫≠t ·ª©ng d·ª•ng", code: "A-C-R", group: "Ngh·ªá thu·∫≠t" },

      // KINH T·∫æ ‚Äì QU·∫¢N L√ù
      { name: "Qu·∫£n tr·ªã kinh doanh", code: "E-C-S", group: "Kinh t·∫ø" },
      { name: "T√†i ch√≠nh ‚Äì Ng√¢n h√†ng", code: "C-E-I", group: "Kinh t·∫ø" },
      { name: "K·∫ø to√°n", code: "C-I-E", group: "Kinh t·∫ø" },
      { name: "Ki·ªÉm to√°n", code: "C-I-E", group: "Kinh t·∫ø" },
      { name: "Th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠", code: "E-I-C", group: "Kinh t·∫ø" },
      { name: "Logistics", code: "E-C-R", group: "Kinh t·∫ø" },
      { name: "Qu·∫£n tr·ªã nh√¢n s·ª±", code: "S-E-C", group: "Qu·∫£n l√Ω" },
      { name: "Kinh doanh qu·ªëc t·∫ø", code: "E-S-C", group: "Kinh t·∫ø" },
      { name: "Qu·∫£n tr·ªã kh√°ch s·∫°n", code: "E-S-C", group: "D·ªãch v·ª•" },
      { name: "Qu·∫£n tr·ªã du l·ªãch", code: "E-S-A", group: "D·ªãch v·ª•" },

      // PH√ÅP LU·∫¨T ‚Äì H√ÄNH CH√çNH
      { name: "Lu·∫≠t", code: "I-E-C", group: "Ph√°p lu·∫≠t" },
      { name: "Lu·∫≠t kinh t·∫ø", code: "I-E-C", group: "Ph√°p lu·∫≠t" },
      { name: "H√†nh ch√≠nh c√¥ng", code: "C-S-E", group: "H√†nh ch√≠nh" },
      { name: "Qu·∫£n l√Ω nh√† n∆∞·ªõc", code: "E-C-S", group: "H√†nh ch√≠nh" },
      { name: "VƒÉn th∆∞ ‚Äì l∆∞u tr·ªØ", code: "C-R-S", group: "H√†nh ch√≠nh" },
      { name: "Thanh tra", code: "I-E-C", group: "Ph√°p lu·∫≠t" },
      { name: "Qu·∫£n l√Ω ƒë·∫•t ƒëai", code: "C-R-I", group: "Qu·∫£n l√Ω" },
      { name: "Qu·∫£n l√Ω ƒë√¥ th·ªã", code: "E-R-C", group: "Qu·∫£n l√Ω" },
      { name: "C√¥ng an", code: "R-S-E", group: "An ninh" },
      { name: "Qu√¢n ƒë·ªôi", code: "R-S-E", group: "An ninh" },

      // N√îNG NGHI·ªÜP ‚Äì KINH T·∫æ XANH
      { name: "N√¥ng h·ªçc", code: "R-I-C", group: "N√¥ng nghi·ªáp" },
      { name: "C√¥ng ngh·ªá th·ª±c ph·∫©m", code: "I-R-C", group: "C√¥ng ngh·ªá" },
      { name: "L√¢m nghi·ªáp", code: "R-I-C", group: "N√¥ng nghi·ªáp" },
      { name: "Nu√¥i tr·ªìng th·ªßy s·∫£n", code: "R-I-C", group: "N√¥ng nghi·ªáp" },
      { name: "Kinh t·∫ø n√¥ng nghi·ªáp", code: "E-I-C", group: "Kinh t·∫ø" },
      { name: "Qu·∫£n l√Ω t√†i nguy√™n", code: "I-R-C", group: "Qu·∫£n l√Ω" },
      { name: "N√¥ng nghi·ªáp c√¥ng ngh·ªá cao", code: "I-R-C", group: "N√¥ng nghi·ªáp" },
      { name: "B·∫£o v·ªá th·ª±c v·∫≠t", code: "I-R-C", group: "N√¥ng nghi·ªáp" },
      { name: "ChƒÉn nu√¥i", code: "R-I-C", group: "N√¥ng nghi·ªáp" },
      { name: "Ph√°t tri·ªÉn n√¥ng th√¥n", code: "S-E-I", group: "X√£ h·ªôi" },

      // ·ª®NG D·ª§NG ‚Äì D·ªäCH V·ª§
      { name: "K·ªπ thu·∫≠t vi√™n ƒëi·ªán", code: "R-C-I", group: "K·ªπ thu·∫≠t" },
      { name: "K·ªπ thu·∫≠t vi√™n CNTT", code: "R-I-C", group: "CNTT" },
      { name: "Thi·∫øt k·∫ø n·ªôi th·∫•t", code: "A-R-C", group: "Ngh·ªá thu·∫≠t" },
      { name: "Thi·∫øt k·∫ø th·ªùi trang", code: "A-E-C", group: "Ngh·ªá thu·∫≠t" },
      { name: "ƒê·∫ßu b·∫øp", code: "R-A-C", group: "D·ªãch v·ª•" },
      { name: "ChƒÉm s√≥c s·∫Øc ƒë·∫πp", code: "A-S-R", group: "D·ªãch v·ª•" },
      { name: "H∆∞·ªõng d·∫´n vi√™n du l·ªãch", code: "S-A-E", group: "D·ªãch v·ª•" },
      { name: "Qu·∫£n l√Ω b√°n l·∫ª", code: "E-C-S", group: "Kinh t·∫ø" },
      { name: "Sales k·ªπ thu·∫≠t", code: "E-R-C", group: "Kinh t·∫ø" },
      { name: "Digital marketing", code: "E-A-C", group: "Truy·ªÅn th√¥ng" },

      // NG√ÄNH M·ªöI ‚Äì XU H∆Ø·ªöNG
      { name: "Tr√≠ tu·ªá nh√¢n t·∫°o ·ª©ng d·ª•ng", code: "I-R-C", group: "CNTT" },
      { name: "Ph√¢n t√≠ch kinh doanh", code: "I-E-C", group: "Kinh t·∫ø" },
      { name: "Kinh t·∫ø s·ªë", code: "E-I-C", group: "Kinh t·∫ø" },
      { name: "Fintech", code: "I-E-C", group: "Kinh t·∫ø" },
      { name: "Edtech", code: "I-S-C", group: "Gi√°o d·ª•c" },
      { name: "C√¥ng ngh·ªá gi√°o d·ª•c", code: "I-S-C", group: "Gi√°o d·ª•c" },
      { name: "Qu·∫£n l√Ω d·ª± √°n", code: "E-C-S", group: "Qu·∫£n l√Ω" },
      { name: "Kh·ªüi nghi·ªáp ƒë·ªïi m·ªõi s√°ng t·∫°o", code: "E-A-I", group: "Kinh t·∫ø" },
      { name: "Kinh t·∫ø xanh", code: "I-E-R", group: "Kinh t·∫ø" },
      { name: "Ph√°t tri·ªÉn b·ªÅn v·ªØng", code: "I-S-R", group: "X√£ h·ªôi" }
    ];

    // ===== UTILS =====
    const $ = (id) => document.getElementById(id);
    const readDB = () => JSON.parse(localStorage.getItem(DB_KEY) || '[]');
    const writeDB = (arr) => localStorage.setItem(DB_KEY, JSON.stringify(arr));
    const readCurrent = () => JSON.parse(localStorage.getItem(RIASEC_KEY) || 'null');
    const writeCurrent = (obj) => localStorage.setItem(RIASEC_KEY, JSON.stringify(obj));

    // ===== PAGE NAVIGATION =====
    function goPage(pageId) {
      // Update Nav
      document.querySelectorAll('.nav-link').forEach(l => {
        l.classList.remove('active');
        if (l.dataset.page === pageId) l.classList.add('active');
      });

      // Update Page
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const target = $(pageId);
      if (target) {
        target.classList.add('active');
        window.scrollTo(0, 0);

        // Page specific init
        if (pageId === 'dashboard') showDashboard();
        if (pageId === 'health') checkHealth();
      }
    }

    // ===== INIT TEST PAGE =====
    function initTest() {
      const container = $('questionsContainer');
      container.innerHTML = '';

      RIASEC_QUESTIONS.forEach((q, idx) => {
        const html = `
        <div class="question-item">
          <label>C√¢u ${idx + 1}. ${q.q}</label>
          <div class="answer-options">
            ${[1, 2, 3, 4, 5].map(v => `
              <div class="answer-option">
                <input type="radio" name="q${idx}" value="${v}" id="q${idx}_${v}" onchange="updateProgress(); updateRealTimeScore()">
                <label for="q${idx}_${v}">${v}</label>
              </div>
            `).join('')}
          </div>
        </div>
      `;
        container.innerHTML += html;
      });
    }

    // ===== PROGRESS TRACKING =====
    function updateProgress() {
      const answered = document.querySelectorAll('input[type="radio"]:checked').length;
      const total = 50;
      const percent = (answered / total) * 100;

      $('progressFill').style.width = percent + '%';
      $('progressText').textContent = `${answered} / ${total} c√¢u`;

      if (answered === total) {
        $('estimatedTime').textContent = '‚úÖ S·∫µn s√†ng n·ªôp';
      }
    }

    // ===== REAL-TIME SCORE UPDATE =====
    function updateRealTimeScore() {
      const answers = document.querySelectorAll('input[type="radio"]:checked');
      const scores = { R: 0, I: 0, A: 0, S: 0, E: 0, C: 0 };

      // We need to map Question Index -> Type
      // Since map is not easily accessible here without parsing Q again, 
      // let's rely on the definition.
      // Q 0-3 -> R, 4-7 -> I, etc...
      // This is brittle. Better: Read value and map via known structure?
      // Actually, let's just use the calculateRIASEC logic but permissive.

      const currentScores = calculateSimpleScores();

      // Render Temp Score
      let tempEl = $('tempScoreDisplay');
      if (!tempEl) {
        tempEl = document.createElement('div');
        tempEl.id = 'tempScoreDisplay';
        tempEl.className = 'score-temp';
        // Note: .active class controls visibility via CSS (only show if we want? or always?)
        // Let's make it show if we have nonzero scores
        document.body.appendChild(tempEl);
      }

      const hasScore = Object.values(currentScores).some(v => v > 0);
      if (hasScore) tempEl.classList.add('active');

      tempEl.innerHTML = `<div style="margin-bottom:0.5rem; color:#ffd700;">üìä ƒêi·ªÉm t·∫°m th·ªùi</div>` + tempHtml;
    }

    // Helper to sum scores without validation
    function calculateSimpleScores() {
      const scores = { R: 0, I: 0, A: 0, S: 0, E: 0, C: 0 };
      // We iterate 0..49
      for (let i = 0; i < 50; i++) {
        const val = parseInt(document.querySelector(`input[name="q${i}"]:checked`)?.value) || 0;
        if (val === 0) continue;

        // Map Index -> Type (Same logic as calculateRIASEC)
        let type = '';
        // Base (0-23) - blocks of 4
        if (i < 24) {
          if (i < 4) type = 'R';
          else if (i < 8) type = 'I';
          else if (i < 12) type = 'A';
          else if (i < 16) type = 'S';
          else if (i < 20) type = 'E';
          else type = 'C';
        }
        // Skills (24-49) - scattered
        // This is hard to replicate perfectly without a look-up.
        // Let's use the Question Object!
        else {
          // Optimization: Look up type from global array
          type = RIASEC_QUESTIONS[i].type;
        }

        if (type && scores[type] !== undefined) {
          scores[type] += val;
        }
      }
      return scores;
    }

    // ===== CALCULATE RIASEC (FINAL) =====
    function calculateRIASEC() {
      // Validate completion
      const answered = document.querySelectorAll('input[type="radio"]:checked').length;
      if (answered < 50) {
        alert(`Vui l√≤ng tr·∫£ l·ªùi h·∫øt 50 c√¢u! (M·ªõi xong ${answered}/50)`);
        return null;
      }

      const scores = calculateSimpleScores();

      const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
      const top3 = sorted.slice(0, 3).map(x => x[0]);

      // Reconstruct raw answers for backend if needed
      const answers = [];
      for (let i = 0; i < 50; i++) answers.push(parseInt(document.querySelector(`input[name="q${i}"]:checked`)?.value) || 0);

      return { scores, top3, answered: 50, raw_answers: answers };
    }



    // ===== SHOW RESULTS =====
    function showResults() {
      const current = readCurrent();
      if (!current) {
        $('majorContainer').innerHTML = '<div class="empty-state">Vui l√≤ng l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc</div>';
        $('scoreDetails').innerHTML = ''; // Clear scores if empty
        return;
      }

      $('riasecDisplay').textContent = current.riasec.join('-');
      const dateStr = (current.time || current.date);
      const safeDate = (dateStr && !isNaN(new Date(dateStr))) ? new Date(dateStr).toLocaleDateString('vi-VN') : 'M·ªõi nh·∫•t';
      $('resultTime').textContent = `Ng√†y: ${safeDate}`;

      // Render Scores
      if (current.scores) {
        const scoreHtml = Object.entries(current.scores)
          .sort((a, b) => b[1] - a[1]) // Sort descending
          .map(([type, score]) => {
            const maxScore = 50;
            const percent = Math.min((score / 45) * 100, 100);
            const colors = {
              'R': '#ff4d4f', 'I': '#ffa940', 'A': '#ffec3d',
              'S': '#73d13d', 'E': '#4096ff', 'C': '#9254de'
            };
            const names = {
              'R': 'Realistic (Th·ª±c t·∫ø)', 'I': 'Investigative (Nghi√™n c·ª©u)', 'A': 'Artistic (Ngh·ªá thu·∫≠t)',
              'S': 'Social (X√£ h·ªôi)', 'E': 'Enterprising (Qu·∫£n l√Ω)', 'C': 'Conventional (Nghi·ªáp v·ª•)'
            };

            return `
            <div style="background: rgba(15, 31, 58, 0.6); border: 1px solid rgba(30, 42, 68, 0.5); padding: 0.75rem; border-radius: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.85rem;">
                <span style="font-weight: 600; color: ${colors[type]};">${names[type]}</span>
                <span style="color: #fff;">${score} ƒëi·ªÉm</span>
              </div>
              <div style="height: 6px; background: rgba(30, 42, 68, 0.5); border-radius: 4px; overflow: hidden;">
                <div style="height: 100%; width: ${percent}%; background: ${colors[type]}; transition: width 0.5s;"></div>
              </div>
            </div>
            `;
          }).join('');

        $('scoreDetails').innerHTML = scoreHtml;
      }

      // RECOMMENDATION LOGIC
      // 1. Get Top 3 types from user result
      const userCodes = current.riasec; // e.g. ["R", "I", "A"]

      // 2. Score and Filter majors
      // Criteria:
      // - Match >= 2 letters (intersection size >= 2)
      // - Bonus for exact position? (Optional, but user said "∆Øu ti√™n: Ng√†nh tr√πng ƒë·ªß 3 k√Ω t·ª±")

      let recommendations = MAJORS_DB.map(job => {
        const jobCodes = job.code.split('-'); // e.g. ["R", "I", "C"]

        // Count matches (order independent)
        const intersection = jobCodes.filter(c => userCodes.includes(c));
        const matchCount = intersection.length; // 0, 1, 2, or 3

        // Calculate a score for sorting
        // Base score = matchCount * 10
        // Exact 3 match = +20 bonus
        let score = matchCount * 10;
        if (matchCount === 3) score += 20;

        // Position bonus (optional fine-tuning)
        // If 1st letter matches 1st letter of user code: +5
        if (jobCodes[0] === userCodes[0]) score += 5;

        return { ...job, matchCount, score };
      });

      // Filter: matchCount >= 2
      recommendations = recommendations.filter(r => r.matchCount >= 2);

      // Sort by score desc
      recommendations.sort((a, b) => b.score - a.score);

      // Pick Top 3-4 diverse results? 
      // User said: "Tr·∫£ v·ªÅ 2‚Äì3 ng√†nh + 1 ng√†nh d·ª± ph√≤ng"
      // Let's take top 4
      const finalRecs = recommendations.slice(0, 4);

      // Render
      if (finalRecs.length === 0) {
        $('majorContainer').innerHTML = '<div class="empty-state">Kh√¥ng t√¨m th·∫•y ng√†nh ph√π h·ª£p s√°t v·ªõi ti√™u ch√≠ (tr√πng >= 2 nh√≥m). H√£y th·ª≠ tham kh·∫£o c√°c ng√†nh chung c·ªßa nh√≥m cao nh·∫•t!</div>';
        return;
      }

      const html = finalRecs.map((m, idx) => `
      <div class="major-card rank-${idx + 1}" style="${idx === 3 ? 'opacity: 0.8; border: 1px dashed rgba(30,42,68,0.5);' : ''}">
        <div class="major-badge" style="${idx === 3 ? 'background: rgba(100,100,100,0.2); border-color: #aaa; color: #aaa;' : ''}">
          ${idx < 3 ? `G·ª£i √Ω #${idx + 1}` : 'D·ª± ph√≤ng'}
        </div>
        <h3>${m.name}</h3>
        <div class="major-code">M√£: <strong>${m.code}</strong> <span style="font-size: 0.8rem; color: #666;">(${m.group})</span></div>
        <p>Ph√π h·ª£p v·ªõi h·ªì s∆°: ${m.code.split('-').map(c => userCodes.includes(c) ? `<b style="color: #4d7cff;">${c}</b>` : c).join('-')}</p>
      </div>
    `).join('');

      $('majorContainer').innerHTML = html;
    }

    // ===== SHOW DASHBOARD =====
    async function showDashboard() {
      const $content = $('dashboardContent');
      $content.innerHTML = '<div style="color: #9fb7ff; text-align: center;">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>';

      try {
        const res = await fetch(`${API_BASE}/api/submissions`);
        if (!res.ok) throw new Error("Failed to load submissions");

        const db = await res.json();

        if (!db.length) {
          $content.innerHTML = '<div class="empty-state">Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc.</div>';
          return;
        }

        // Reverse to show latest first
        const rows = [...db].reverse();

        const html = `
            <div style="overflow-x: auto; background: rgba(15, 31, 58, 0.8); border: 1px solid rgba(30, 42, 68, 0.5); border-radius: 12px; padding: 1rem;">
            <h3 style="margin-bottom: 1rem; color: #4d7cff;">üìã Danh s√°ch k·∫øt qu·∫£ chi ti·∫øt (To√†n h·ªá th·ªëng)</h3>
            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 1000px;">
                <thead style="background: rgba(26, 60, 255, 0.2); color: #fff;">
                <tr>
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid rgba(30, 42, 68, 0.5);">STT</th>
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid rgba(30, 42, 68, 0.5);">Ng√†y</th>
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid rgba(30, 42, 68, 0.5);">H·ªç t√™n</th>
                    <th style="padding: 0.75rem; text-align: center; border: 1px solid rgba(30, 42, 68, 0.5);">RIASEC</th>
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid rgba(30, 42, 68, 0.5); width: 25%;">C√°c ng√†nh g·ª£i √Ω</th>
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid rgba(30, 42, 68, 0.5);">T·ªï h·ª£p x√©t tuy·ªÉn</th>
                </tr>
                </thead>
                <tbody>
                ${rows.map((row, index) => {
          const s = row.scores || {};
          return `
                    <tr style="border-bottom: 1px solid rgba(30, 42, 68, 0.3);">
                    <td style="padding: 0.75rem; border: 1px solid rgba(30, 42, 68, 0.5); text-align: center;">${index + 1}</td>
                    <td style="padding: 0.75rem; border: 1px solid rgba(30, 42, 68, 0.5);">
                        ${(row.time && !isNaN(new Date(row.time))) ? new Date(row.time).toLocaleDateString('vi-VN') : 'M·ªõi nh·∫•t'}
                    </td>
                    <td style="padding: 0.75rem; border: 1px solid rgba(30, 42, 68, 0.5); font-weight: 500;">
                        ${row.name || '·∫®n danh'}<br>
                        <span style="font-size: 0.8rem; color: #9fb7ff;">${row.class || '-'}</span>
                    </td>
                    
                    <td style="padding: 0.75rem; border: 1px solid rgba(30, 42, 68, 0.5); text-align: center;">
                        <span class="badge" style="background: rgba(26, 60, 255, 0.1); border-color: rgba(77, 124, 255, 0.5);">
                        ${(row.riasec || []).join('-')}
                        </span>
                    </td>
                    
                    <td style="padding: 0.75rem; border: 1px solid rgba(30, 42, 68, 0.5); font-size: 0.85rem;">
                        ${row.suggestedMajors || '<i style="color: #666">Ch∆∞a c√≥ d·ªØ li·ªáu</i>'}
                    </td>
                    
                    <td style="padding: 0.75rem; border: 1px solid rgba(30, 42, 68, 0.5); font-size: 0.85rem;">
                        ${row.combinations || '<i style="color: #666">-</i>'}
                    </td>
                    </tr>
                    `;
        }).join('')}
                </tbody>
            </table>
            <div style="margin-top: 1rem; text-align: right;">
                <span style="font-size: 0.85rem; color: #9fb7ff;">T·ªïng s·ªë b·∫£n ghi: <strong>${db.length}</strong></span>
            </div>
            </div>
        `;
        $content.innerHTML = html;

      } catch (e) {
        $content.innerHTML = `<div class="empty-state" style="color: #ff4d4f;">L·ªói t·∫£i d·ªØ li·ªáu: ${e.message}</div>`;
      }
    }

    // ===== RESET TEST =====
    // ===== RESET TEST =====
    function resetTest() {
      if (!confirm('Xo√° h·∫øt d·ªØ li·ªáu nh·∫≠p li·ªáu?')) return;
      document.getElementById('testForm').reset();
      $('progressFill').style.width = '0%';
      $('progressText').textContent = '0 / 50 c√¢u';
      $('estimatedTime').textContent = '~10 ph√∫t';

      // Clear local storage for current user
      localStorage.removeItem(RIASEC_KEY); // Removes 'current'

      // Clear chat session
      sessionStorage.removeItem('conversation_id');
      const msgBox = $('messagesBox');
      if (msgBox) msgBox.innerHTML = '<div style="color: #9fb7ff; font-size: 0.9rem;"><strong>ü§ñ AI:</strong> Xin ch√†o! T√¥i s·∫µn s√†ng t∆∞ v·∫•n cho b·∫°n d·ª±a tr√™n k·∫øt qu·∫£ RIASEC. Nh·∫•n n√∫t "B·∫Øt ƒë·∫ßu t∆∞ v·∫•n" b√™n d∆∞·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div>';

      // Clear temp graphics if any
      const tempEl = $('tempScoreDisplay');
      if (tempEl) {
        tempEl.remove();
      }

      alert("ƒê√£ l√†m m·ªõi d·ªØ li·ªáu c·ª•c b·ªô! (D·ªØ li·ªáu tr√™n Server v·∫´n ƒë∆∞·ª£c gi·ªØ)");
    }

    // ===== CLEAR ALL DATA =====
    // Deprecated for Global Data. Replaced with simple local session clear.
    function clearAllData() {
      alert("D·ªØ li·ªáu hi·ªán ƒë∆∞·ª£c l∆∞u tr·ªØ t·∫≠p trung tr√™n Server n√™n kh√¥ng th·ªÉ xo√° s·∫°ch t·ª´ ƒë√¢y.");
    }

    // ===== RECOMMENDATION LOGIC HELPER =====
    const GROUP_COMBINATIONS = {
      "CNTT": "A00, A01, D01",
      "Y Sinh": "B00, A00, D07",
      "Gi√°o d·ª•c": "C00, D01, A00",
      "X√£ h·ªôi": "C00, D01, D14",
      "Ngh·ªá thu·∫≠t": "H00, V00, H01",
      "Truy·ªÅn th√¥ng": "C00, D01, A01",
      "Kinh t·∫ø": "A00, A01, D01",
      "Qu·∫£n l√Ω": "A00, A01, D01",
      "D·ªãch v·ª•": "C00, D01, A00",
      "Ph√°p lu·∫≠t": "A00, A01, C00",
      "H√†nh ch√≠nh": "C00, D01, A01",
      "An ninh": "A00, C03, D01",
      "N√¥ng nghi·ªáp": "B00, A00, D01",
      "C√¥ng ngh·ªá": "A00, A01, B00",
      "K·ªπ thu·∫≠t": "A00, A01, D01"
    };

    function getRecommendations(userCodes) {
      // Logic copied and adapted from showResults
      let recommendations = MAJORS_DB.map(job => {
        const jobCodes = job.code.split('-');
        const intersection = jobCodes.filter(c => userCodes.includes(c));
        const matchCount = intersection.length;

        let score = matchCount * 10;
        if (matchCount === 3) score += 20;
        if (jobCodes[0] === userCodes[0]) score += 5;

        return { ...job, matchCount, score };
      });

      // Filter and Sort
      recommendations = recommendations.filter(r => r.matchCount >= 2);
      recommendations.sort((a, b) => b.score - a.score);

      const top4 = recommendations.slice(0, 4);

      return top4.map(major => ({
        name: major.name,
        combinations: GROUP_COMBINATIONS[major.group] || "A00, A01"
      }));
    }

    // ===== SUBMIT TEST =====
    async function submitTest() {
      try {
        if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i?')) return;

        const result = calculateRIASEC();
        if (!result) return; // Validation failed

        const { scores, top3, raw_answers } = result;

        // Calculate Recommendations for saving
        const recs = getRecommendations(top3);
        const majorNames = recs.map(r => r.name).join(', ');
        const uniqueCombs = [...new Set(recs.map(r => r.combinations))].join(' | ');

        // Save to LocalStorage (Immediate UI update)
        const resultObj = {
          scores,
          riasec: top3,
          date: new Date().toISOString(),
          name: $('name').value,
          class: $('class').value,
          school: $('school').value
        };
        writeCurrent(resultObj);

        // Safe ID generation
        const safeId = (typeof crypto !== 'undefined' && crypto.randomUUID)
          ? crypto.randomUUID()
          : 'sub_' + Math.random().toString(36).substr(2, 9);

        // Save to Backend (Async) - MUST MATCH PYDANTIC MODEL
        const payload = {
          name: $('name').value || "·∫®n danh",
          class: $('class').value || "-", // Pydantic alias="class"
          school: $('school').value || "-",
          riasec: top3,           // Expects List[str]
          scores: scores,         // Expects Dict[str, int]
          answers: raw_answers,   // Expects List[int]
          time: new Date().toISOString(), // Expects "time"
          suggestedMajors: majorNames,
          combinations: uniqueCombs
        };

        console.log("Sending payload:", payload);

        try {
          const res = await fetch(`${API_BASE}/api/submissions`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          if (res.ok) {
            console.log("‚úÖ Saved to backend");
          } else {
            console.error("‚ùå Failed to save backend", await res.text());
          }
        } catch (e) {
          console.error("‚ùå Network error saving backend", e);
        }

        // Go to Results
        showResults();
        goPage('results');

      } catch (err) {
        alert('L·ªói h·ªá th·ªëng: ' + err.message);
        console.error(err);
      }
    }

    // ===== CHATBOT =====
    // Use relative URL - works on localhost and production
    const API_BASE = window.location.origin;

    function updateChatContext() {
      const current = readCurrent();
      const ctx = $('chatContext');
      if (!ctx) return;

      if (!current) {
        ctx.innerHTML = '‚ùå Ch∆∞a c√≥ d·ªØ li·ªáu. Vui l√≤ng <strong onclick="goPage(\'test\')">l√†m tr·∫Øc nghi·ªám</strong> tr∆∞·ªõc.';
        return;
      }

      // Check if we have an active session
      if (sessionStorage.getItem('conversation_id')) {
        $('consultBtn').textContent = "üîÑ B·∫Øt ƒë·∫ßu l·∫°i cu·ªôc h·ªôi tho·∫°i";
      } else {
        $('consultBtn').textContent = "‚ú® B·∫Øt ƒë·∫ßu t∆∞ v·∫•n";
      }

      ctx.innerHTML = `
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div>
          <strong>üë§ H·ªçc sinh:</strong> ${current.name || '·∫®n danh'}
        </div>
        <div>
          <strong>üìö L·ªõp / Tr∆∞·ªùng:</strong> ${current.class || '-'} / ${current.school || '-'}
        </div>
        <div>
          <strong>üéØ RIASEC:</strong> <span style="background: rgba(26, 60, 255, 0.3); padding: 0.25rem 0.5rem; border-radius: 4px;">${current.riasec.join('-')}</span>
        </div>
        <div>
          <strong>‚è±Ô∏è Ng√†y:</strong> ${(current.time && !isNaN(new Date(current.time))) ? new Date(current.time).toLocaleDateString('vi-VN') : 'M·ªõi nh·∫•t'}
        </div>
      </div>
    `;
      $('consultBtn').disabled = false;
    }

    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function formatMarkdownText(text) {
      // First escape HTML to prevent broken tags
      let safeText = escapeHtml(text);

      // Convert markdown-style formatting to HTML
      let html = safeText
        // Bold: **text** ‚Üí <strong>text</strong>
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        // Headers: Roman numerals + ALL CAPS
        .replace(/^(I+\..*?)$/gm, '<h4 style="margin: 1rem 0 0.5rem 0; color: #cfe0ff; font-size: 1rem;">$1</h4>')
        // Numbered lists: 1. ‚Üí formatted list
        .replace(/^(\d+\.\s)(.*)$/gm, '<div style="margin-left: 1rem; margin-bottom: 0.5rem;">$1$2</div>')
        // Dashes to bullet points: - ‚Üí ‚Ä¢
        .replace(/^- /gm, '&nbsp;&nbsp;‚Ä¢ ')
        // Line breaks: Apply LAST to preserve regex anchors (^ $)
        .replace(/\n/g, '<br>');

      return html;
    }

    function addChatMessage(sender, text, isLoading = false) {
      const messagesBox = $('messagesBox');
      const msg = document.createElement('div');
      msg.style.cssText = 'color: #9fb7ff; font-size: 0.95rem; line-height: 1.8; margin-bottom: 1rem; white-space: pre-wrap; word-wrap: break-word;';

      if (sender === 'user') {
        msg.innerHTML = `<strong style="color: #cfe0ff;">üë§ B·∫°n:</strong> ${escapeHtml(text)}`;
      } else {
        const formattedText = formatMarkdownText(text);
        msg.innerHTML = `<div style="color: #4d7cff;"><strong>ü§ñ AI:</strong></div><div style="margin-top: 0.5rem; color: #9fb7ff;">${isLoading ? '<em>ƒêang suy nghƒ©...</em>' : formattedText}</div>`;
      }

      messagesBox.appendChild(msg);
      messagesBox.scrollTop = messagesBox.scrollHeight;
    }

    async function requestCounsel() {
      const current = readCurrent();
      if (!current) {
        alert('Vui l√≤ng l√†m tr·∫Øc nghi·ªám tr∆∞·ªõc');
        return;
      }

      const $consultBtn = $('consultBtn');
      const $loadingOverlay = $('loadingOverlay');

      $consultBtn.disabled = true;
      $loadingOverlay.classList.add('active');

      try {
        // Use actual answers if available, otherwise fallback (for old data) but warn
        let answerArray = current.answers;

        if (!answerArray || answerArray.length !== 50) {
          console.warn("Missing raw answers in storage, attempting partial reconstruction (Not recommended for consistency)");
          // Fallback logic could go here, but better to alert user
          // For now we keep the old logic ONLY as a fallback for legacy local data
          answerArray = [];
          const scores = current.scores;
          const letters = ['R', 'I', 'A', 'S', 'E', 'C'];
          for (let i = 0; i < 50; i++) {
            const letterIdx = i % 6;
            const letter = letters[letterIdx];
            const baseScore = Math.round(scores[letter] / 6);
            answerArray.push(Math.max(1, Math.min(5, baseScore)));
          }
        }

        // Calculate Top 3 for Prompt
        let scoreString = "";
        if (current.scores) {
          const sortedItems = Object.entries(current.scores)
            .sort((a, b) => b[1] - a[1]) // Sort desc
            .slice(0, 3); // Get top 3

          // Format: [S: 25, A: 20, C: 15]
          scoreString = sortedItems.map(item => `${item[0]}: ${item[1]}`).join(", ");
        }

        console.log('üì§ Sending to API:', {
          name: current.name,
          class: current.class,
          school: current.school,
          answer: answerArray
        });

        const initialPrompt = `H√£y gi·ªõi thi·ªáu v·ªÅ c√°c h∆∞·ªõng nghi·ªáp ph√π h·ª£p cho t√¥i d·ª±a tr√™n k·∫øt qu·∫£ RIASEC c·ªßa t√¥i. H√£y theo k·∫øt qu·∫£ n√†y: [${scoreString}]. H√£y tr·∫£ l·ªùi s√∫c t√≠ch, ng·∫Øn g·ªçn, ƒë·∫£m b·∫£o kh√¥ng b·ªã c·∫Øt ngang gi·ªØa ch·ª´ng.`;

        const response = await fetch(`${API_BASE}/start-conversation`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: current.name || '·∫®n danh',
            class: current.class || '-',
            school: current.school || '-',
            answer: answerArray,
            initial_question: initialPrompt
          })
        });

        if (!response.ok) {
          let errorMsg = `HTTP ${response.status}`;
          try {
            const errorData = await response.json();
            errorMsg = errorData.detail || errorMsg;
          } catch (e) { }
          throw new Error(errorMsg);
        }

        const data = await response.json();
        console.log('üì• API Response:', data);

        const aiResponse = data.ai_response || 'Kh√¥ng c√≥ ph·∫£n h·ªìi t·ª´ AI';
        const conversationId = data.conversation_id;

        // Store conversation ID for future messages
        if (conversationId) {
          sessionStorage.setItem('conversation_id', conversationId);
        }

        // Clear previous messages if starting new
        $('messagesBox').innerHTML = '';

        // Show the initial question from user
        addChatMessage('user', "H√£y gi·ªõi thi·ªáu v·ªÅ c√°c h∆∞·ªõng nghi·ªáp ph√π h·ª£p cho t√¥i d·ª±a tr√™n k·∫øt qu·∫£ RIASEC c·ªßa t√¥i");

        addChatMessage('ai', aiResponse);

        // Update button state
        $consultBtn.textContent = "üîÑ B·∫Øt ƒë·∫ßu l·∫°i cu·ªôc h·ªôi tho·∫°i";
      } catch (err) {
        console.error('‚ùå Fetch error:', err);
        const errorMsg = err.message;

        if (errorMsg.includes('Failed to fetch') || errorMsg.includes('NetworkError')) {
          addChatMessage('ai', `
          ‚ùå <strong>L·ªói k·∫øt n·ªëi:</strong> Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi backend API (${API_BASE}).<br><br>
          <strong>C√°ch kh·∫Øc ph·ª•c:</strong><br>
          1. M·ªü terminal v√† ch·∫°y:<br>
          <code style="background: #081225; padding: 0.25rem 0.5rem; border-radius: 4px;">uvicorn backend.main:app --reload --host 0.0.0.0 --port 8000</code><br>
          2. Sau ƒë√≥ t·∫£i l·∫°i trang web n√†y
        `);
        } else {
          addChatMessage('ai', `‚ùå <strong>L·ªói API:</strong> ${errorMsg}`);
        }
      } finally {
        $consultBtn.disabled = false;
        $loadingOverlay.classList.remove('active');
      }
    }

    async function sendChatMessage() {
      const input = $('chatInput');
      const text = input.value.trim();
      if (!text) return;

      // Get conversation ID from session
      const conversationId = sessionStorage.getItem('conversation_id');
      if (!conversationId) {
        alert('Vui l√≤ng nh·∫•n "Y√™u c·∫ßu t∆∞ v·∫•n" ƒë·ªÉ b·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán');
        return;
      }

      addChatMessage('user', text);
      input.value = '';

      const $loadingOverlay = $('loadingOverlay');
      $loadingOverlay.classList.add('active');

      try {
        const response = await fetch(`${API_BASE}/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            conversation_id: conversationId,
            message: text
          })
        });

        if (!response.ok) {
          let errorMsg = `HTTP ${response.status}`;
          try {
            const errorData = await response.json();
            errorMsg = errorData.detail || errorMsg;
          } catch (e) { }

          if (response.status === 404) {
            throw new Error("Cu·ªôc h·ªôi tho·∫°i ƒë√£ h·∫øt h·∫°n ho·∫∑c server ƒë√£ kh·ªüi ƒë·ªông l·∫°i. Vui l√≤ng nh·∫•n n√∫t 'B·∫Øt ƒë·∫ßu l·∫°i cu·ªôc h·ªôi tho·∫°i' ƒë·ªÉ k·∫øt n·ªëi l·∫°i.");
          }
          throw new Error(errorMsg);
        }

        const data = await response.json();
        const aiResponse = data.ai_response || 'Kh√¥ng c√≥ ph·∫£n h·ªìi t·ª´ AI';
        addChatMessage('ai', aiResponse);
      } catch (err) {
        console.error('‚ùå Chat error:', err);
        addChatMessage('ai', `‚ùå <strong>L·ªói:</strong> ${err.message}`);
      } finally {
        $loadingOverlay.classList.remove('active');
      }
    }

    // Enter to send
    $('chatInput')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendChatMessage();
    });

    // ===== INIT =====
    document.querySelectorAll('.nav-link').forEach(a => {
      a.addEventListener('click', (e) => {
        e.preventDefault();
        const page = a.dataset.page;
        if (page === 'chatbot') updateChatContext();
        if (page === 'vr-mode') renderVRJobs();
        goPage(page);
      });
    });

    // Init test page when landing is loaded
    window.addEventListener('load', () => {
      initTest();

      // Restore Dev Mode
      const savedDevMode = localStorage.getItem('careervr_dev_mode') === 'true';
      if (savedDevMode) {
        toggleGlobalDevMode(true);
      }
    });

    // ===== VR EXPERIENCE LOGIC =====
    const VR_JOBS_KEY = 'careervr_jobs_v1';

    // Default data
    const DEFAULT_VR_JOBS = [
      {
        id: 'job_1',
        title: 'Ngh·ªÅ B√°o ch√≠ - Truy·ªÅn th√¥ng',
        videoId: 'BZgv0k_0IQs',
        description: 'Theo ch√¢n ph√≥ng vi√™n hi·ªán tr∆∞·ªùng v√† bi√™n t·∫≠p vi√™n ƒë·ªÉ hi·ªÉu v·ªÅ √°p l·ª±c v√† vinh quang c·ªßa ngh·ªÅ b√°o.',
        icon: 'üé•'
      },
      {
        id: 'job_2',
        title: 'H∆∞·ªõng d·∫´n vi√™n du l·ªãch',
        videoId: 'OXIxyXcia4M',
        description: 'Tr·∫£i nghi·ªám m·ªôt ng√†y d·∫´n ƒëo√†n, thuy·∫øt minh v√† x·ª≠ l√Ω t√¨nh hu·ªëng du l·ªãch th·ª±c t·∫ø.',
        icon: 'üó∫Ô∏è'
      },
      {
        id: 'job_3',
        title: 'Ngh·ªÅ Lu·∫≠t s∆∞',
        videoId: 'itq_QL6q23g',
        description: 'Tham gia phi√™n t√≤a gi·∫£ ƒë·ªãnh v√† t√¨m hi·ªÉu quy tr√¨nh tranh t·ª•ng, t∆∞ v·∫•n ph√°p l√Ω.',
        icon: '‚öñÔ∏è'
      }
    ];

    // Global VR Jobs Cache
    let GLOBAL_VR_JOBS = [];

    // Load jobs from Backend
    async function fetchVRJobs() {
      try {
        const res = await fetch(`${API_BASE}/api/vr-jobs`);
        if (res.ok) {
          GLOBAL_VR_JOBS = await res.json();
          renderVRJobs(); // update UI
        } else {
          console.error("Failed to fetch VR jobs");
        }
      } catch (e) {
        console.error("Error fetching VR jobs:", e);
        // Fallback if needed, or just show empty
      }
    }

    // Save jobs to Backend
    async function saveVRJobs(jobs) {
      try {
        const res = await fetch(`${API_BASE}/api/vr-jobs`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(jobs)
        });
        if (res.ok) {
          GLOBAL_VR_JOBS = jobs; // Update local cache
          renderVRJobs();
        } else {
          alert("L·ªói khi l∆∞u d·ªØ li·ªáu l√™n Server!");
        }
      } catch (e) {
        alert("L·ªói k·∫øt n·ªëi Server: " + e.message);
      }
    }

    // Render Grid (Uses Cache)
    function renderVRJobs() {
      const jobs = GLOBAL_VR_JOBS;
      const container = $('vrGrid');
      const isDev = localStorage.getItem('careervr_dev_mode') === 'true';

      container.innerHTML = jobs.map(job => `
            <div style="background: rgba(15, 31, 58, 0.6); border: 1px solid rgba(30, 42, 68, 0.5); padding: 1.5rem; border-radius: 12px; transition: transform 0.2s; position: relative;" class="vr-card">
              ${isDev ? `
                <div style="position: absolute; top: 10px; right: 10px; display: flex; gap: 0.5rem;">
                    <button onclick="editVRJob('${job.id}')" style="background: rgba(0,0,0,0.5); border: 1px solid #4d7cff; color: #fff; border-radius: 4px; cursor: pointer; padding: 2px 6px;">‚úèÔ∏è</button>
                    <button onclick="deleteVRJob('${job.id}')" style="background: rgba(0,0,0,0.5); border: 1px solid #ff4d4f; color: #fff; border-radius: 4px; cursor: pointer; padding: 2px 6px;">üóëÔ∏è</button>
                </div>
              ` : ''}
              
              <div style="cursor: pointer;" onclick="openVideoModal('${job.videoId}', '${escapeHtml(job.title)}')">
                  <div style="font-size: 2.5rem; margin-bottom: 1rem;">${job.icon || 'üé¨'}</div>
                  <h3 style="margin-bottom: 1rem; color: #4d7cff;">${job.title}</h3>
                  
                  <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; background: #000; margin-bottom: 1rem;">
                    <img src="https://img.youtube.com/vi/${job.videoId}/mqdefault.jpg" style="position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0.7;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(26,60,255,0.8); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">‚ñ∂</div>
                  </div>

                  <p style="font-size: 0.9rem; color: #9fb7ff;">${job.description}</p>
              </div>
            </div>
        `).join('');


      // Update control visibility
      const controls = $('vrControls');
      const devTools = $('devTools');


      controls.style.display = 'block';
      if (isDev) {
        devTools.style.display = "flex";
      } else {
        devTools.style.display = "none";
      }
    }

    // Modal Logic
    function openVideoModal(videoId, title) {
      const modal = $('videoModal');
      const iframe = $('videoFrame');
      const titleEl = $('videoTitle');

      iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
      titleEl.textContent = title;
      modal.classList.add('active');
    }

    function closeVideoModal(e) {
      if (e && e.target !== $('videoModal') && !e.target.classList.contains('loading-modal')) return; // Allow clicking X
      if (e && e.target.closest && e.target.closest('.loading-modal') && e.target !== $('videoModal')) return; // Click inside modal logic fix

      // Simple close logic: if e is present check target, else force close
      if (e && e.target !== $('videoModal')) {
        // check if clicked button
        if (e.target.innerText !== '√ó' && !e.target.closest('button')) return;
      }

      const modal = $('videoModal');
      const iframe = $('videoFrame');

      iframe.src = ""; // Stop video
      modal.classList.remove('active');
    }

    // Make global for onclick
    window.closeVideoModal = () => {
      const modal = $('videoModal');
      const iframe = $('videoFrame');
      iframe.src = "";
      modal.classList.remove('active');
    }

    // Global Dev Mode Logic
    function toggleGlobalDevMode(forceState = null) {
      const current = document.body.classList.contains('dev-mode');
      const isDev = forceState !== null ? forceState : !current;

      if (isDev) {
        document.body.classList.add('dev-mode');
      } else {
        document.body.classList.remove('dev-mode');
      }

      // Save state
      localStorage.setItem('careervr_dev_mode', isDev);

      const btn = $('navDevToggle');

      if (isDev) {
        btn.textContent = "üß™ Dev Mode: ON";
        btn.style.background = "rgba(255, 215, 0, 0.2)";
        btn.style.color = "#ffd700";
        btn.style.borderColor = "#ffd700";

        // Show Health Link (Handled by CSS .dev-mode .dev-only)
      } else {
        btn.textContent = "üõ†Ô∏è Dev";
        btn.style.background = "transparent";
        btn.style.color = "#ffd700";
        btn.style.borderColor = "rgba(255, 215, 0, 0.5)";

        // If we are on a dev-only page, redirect home
        const activePage = document.querySelector('.page.active');
        if (activePage && activePage.classList.contains('dev-only')) {
          goPage('landing');
        }
      }

      // Toggle visibility of Dev elements in questions (if configured)
      // Toggle visibility of Dev elements in questions (if configured)
      document.querySelectorAll('.dev-fill-btn').forEach(el => {
        el.style.display = isDev ? 'inline-block' : 'none';
      });
    }

    async function checkHealth() {
      const content = $('healthContent');
      if (!content) return;

      content.innerHTML = '<div class="spinner"></div><p>Checking system status...</p>';

      try {
        const res = await fetch(`${API_BASE}/api/health`);
        const data = await res.json();

        const isConnected = data.db_connected;
        const statusColor = isConnected ? 'status-ok' : 'status-error';
        const statusIcon = isConnected ? '‚úÖ' : '‚ùå';

        content.innerHTML = `
                <div class="status-indicator ${statusColor}">${statusIcon}</div>
                <h3>${isConnected ? 'System Healthy' : 'System Information'}</h3>
                <div style="margin-top: 1.5rem; text-align: left; display: inline-block;">
                    <p><strong>Database Type:</strong> ${data.db_type}</p>
                    <p><strong>DB Name:</strong> ${data.database_name}</p>
                    <p><strong>API Status:</strong> ${data.status.toUpperCase()}</p>
                </div>
                <div style="margin-top: 2rem;">
                    <button onclick="checkHealth()" class="btn btn-secondary">üîÑ Refresh</button>
                </div>
            `;
      } catch (e) {
        content.innerHTML = `
                <div class="status-indicator status-error">‚ö†Ô∏è</div>
                <h3>Connection Failed</h3>
                <p>Could not reach backend API.</p>
                <div style="margin-top: 1rem;">
                    <button onclick="checkHealth()" class="btn btn-secondary">üîÑ Try Again</button>
                </div>
            `;
      }
    }

    function updateDevModeUI() {
      const isDev = localStorage.getItem('careervr_dev_mode') === 'true';
      const navBtn = $('navDevToggle');

      // 1. Update Nav Button style
      if (isDev) {
        navBtn.textContent = "üõ†Ô∏è ON";
        navBtn.style.background = "rgba(255, 215, 0, 0.2)";
        navBtn.style.color = "#ffd700";
        navBtn.style.borderColor = "#ffd700";
      } else {
        navBtn.textContent = "üõ†Ô∏è Dev";
        navBtn.style.background = "transparent";
        navBtn.style.color = "#9fb7ff";
        navBtn.style.borderColor = "#2a3b66";
      }

      // 2. Update RIASEC Page (Dev Fill Button)
      const btnFill = $('btnDevFill');
      if (btnFill) btnFill.style.display = isDev ? 'inline-block' : 'none';

      // 3. Update VR Page (render to show/hide edit buttons)
      if (document.querySelector('#vrGrid')) {
        renderVRJobs();
      }

      // 4. Update Clear Data Button (Dashboard)
      const btnClear = $('btnClearData');
      if (btnClear) btnClear.style.display = isDev ? 'inline-block' : 'none';
    }

    // Call on load
    window.addEventListener('load', () => {
      updateDevModeUI();
      fetchVRJobs(); // Initial fetch
    });

    function resetVRData() {
      if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën Reset d·ªØ li·ªáu VR v·ªÅ m·∫∑c ƒë·ªãnh kh√¥ng?')) {
        localStorage.removeItem(VR_JOBS_KEY);
        renderVRJobs();
      }
    }

    // Dev Modal Handlers
    function openDevModal() {
      $('devJobModal').classList.add('active');
    }

    function closeDevModal() {
      $('devJobModal').classList.remove('active');
      // Clear form
      $('devJobId').value = '';
      $('devJobTitle').value = '';
      $('devJobVideoId').value = '';
      $('devJobDesc').value = '';
      $('devJobIcon').value = '';
    }

    function addNewVRJob() {
      // Open empty modal
      $('devJobId').value = 'new';
      $('devJobTitle').value = '';
      $('devJobVideoId').value = '';
      $('devJobDesc').value = '';
      $('devJobIcon').value = 'üé•';
      openDevModal();
    }

    function editVRJob(id) {
      const jobs = GLOBAL_VR_JOBS; // Use Cache
      const job = jobs.find(j => j.id === id);
      if (!job) return;

      $('devJobId').value = job.id;
      $('devJobTitle').value = job.title;
      $('devJobVideoId').value = job.videoId;
      $('devJobDesc').value = job.description;
      $('devJobIcon').value = job.icon;

      openDevModal();
    }

    function saveDevJob() {
      const id = $('devJobId').value;
      const title = $('devJobTitle').value;
      const videoId = $('devJobVideoId').value;
      const description = $('devJobDesc').value;
      const icon = $('devJobIcon').value;

      if (!title || !videoId) {
        alert("Vui l√≤ng nh·∫≠p Ti√™u ƒë·ªÅ v√† Video ID!");
        return;
      }

      // Clone current jobs
      const jobs = [...GLOBAL_VR_JOBS];

      if (id === 'new') {
        // Create
        jobs.push({
          id: 'job_' + Date.now(),
          title, videoId, description, icon
        });
      } else {
        // Update
        const idx = jobs.findIndex(j => j.id === id);
        if (idx !== -1) {
          jobs[idx] = { ...jobs[idx], title, videoId, description, icon };
        }
      }

      saveVRJobs(jobs); // Async save
      closeDevModal();
    }

    function deleteVRJob(id) {
      if (!confirm('Xo√° ngh·ªÅ n√†y?')) return;
      const jobs = GLOBAL_VR_JOBS.filter(j => j.id !== id);
      saveVRJobs(jobs);
    }


    // ===== DEV UTILS =====
    function devAutoFill() {
      // Fill personal info if empty
      if (!$('name').value) $('name').value = "Dev Tester";
      if (!$('class').value) $('class').value = "12A Dev";
      if (!$('school').value) $('school').value = "THPT Dev Mode";

      // Randomly click 50 answers
      for (let i = 0; i < 50; i++) {
        const val = Math.floor(Math.random() * 5) + 1; // 1-5
        const radio = document.getElementById(`q${i}_${val}`);
        if (radio) {
          radio.checked = true;
        }
      }
      updateProgress();
      // Scroll to bottom
      window.scrollTo(0, document.body.scrollHeight);
    }

//CHART
/* ===== ANIMATION WHEN SCROLL INTO VIEW ===== */
const bars = document.querySelectorAll(".bar");

function animateBars() {

  bars.forEach((bar, index) => {

    const value = parseFloat(bar.dataset.value);

    setTimeout(() => {

      // Animate height
      bar.style.height = (value / 80) * 400 + "px";

      // Animate counter
      let start = 0;
      const duration = 1000;
      const step = value / (duration / 16);

      const counter = setInterval(() => {
        start += step;
        if (start >= value) {
          start = value;
          clearInterval(counter);
        }
        bar.setAttribute("data-display", start.toFixed(2) + "%");
      }, 16);

    }, index * 300);

  });

}

window.addEventListener("load", animateBars);


</script>

</body>

</html>