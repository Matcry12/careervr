{% extends "base.html" %}

{% block title %}C·ªông ƒë·ªìng - CareerGo{% endblock %}

{% block loading_text %}ƒêang t·∫£i...{% endblock %}

{% block content %}
<style>
    /* Facebook-like Layout Styles */
    .community-wrapper {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 280px 1fr 300px; /* Left - Center - Right */
        gap: 20px;
        align-items: start;
        padding-top: 20px;
    }

    /* Mobile Responsive */
    @media (max-width: 992px) {
        .community-wrapper {
            grid-template-columns: 1fr; /* Stack everything on mobile */
        }
        .comm-sidebar-left, .comm-sidebar-right {
            display: none; /* Hide sidebars on mobile or move to bottom via JS if needed */
        }
        /* Optional: Show specific mobile nav if needed */
    }

    /* Sticky Sidebars */
    .comm-sidebar-left, .comm-sidebar-right {
        position: sticky;
        top: 20px;
    }

    /* FB-style Composer */
    .fb-composer-trigger {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        cursor: pointer;
        transition: background 0.2s;
    }
    .fb-composer-trigger:hover {
        background-color: rgba(0,0,0,0.02);
    }
    .fb-avatar-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #ddd; /* Placeholder color */
        flex-shrink: 0;
    }
    .fb-input-fake {
        background-color: #f0f2f5;
        border-radius: 20px;
        padding: 10px 16px;
        flex-grow: 1;
        color: #65676b;
        font-size: 0.95rem;
        user-select: none;
    }
    .fb-input-fake:hover {
        background-color: #e4e6eb;
    }

    /* Filters Bar */
    .fb-filters {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 16px;
        border-bottom: 1px solid rgba(0,0,0,0.1);
        margin-bottom: 10px;
    }

    /* Sidebar Links */
    .sidebar-menu-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px;
        border-radius: 8px;
        color: inherit;
        text-decoration: none;
        transition: background 0.2s;
        cursor: pointer;
    }
    .sidebar-menu-item:hover {
        background-color: rgba(0,0,0,0.05);
    }
    .sidebar-menu-item.active {
        background-color: rgba(var(--primary-rgb, 0, 123, 255), 0.1);
        color: var(--primary-color, #007bff);
        font-weight: 600;
    }
    .sidebar-icon {
        width: 24px;
        text-align: center;
        font-size: 1.2rem;
    }
</style>

<section class="page active" id="community">
    <!-- Top Bar: Journey Stepper (Like Stories/Header) -->
    <div class="panel" style="margin-bottom: 20px; padding: 15px;">
        <h1 class="section-title" style="margin-bottom: 10px; font-size: 1.5rem;">C·ªông ƒë·ªìng CareerGo</h1>
        <div class="journey-stepper" aria-label="H√†nh tr√¨nh h∆∞·ªõng nghi·ªáp">
            <div class="journey-step"><span class="step-dot">1</span><span>Tr·∫Øc nghi·ªám</span></div>
            <div class="journey-step"><span class="step-dot">2</span><span>K·∫øt qu·∫£</span></div>
            <div class="journey-step"><span class="step-dot">3</span><span>VR</span></div>
            <div class="journey-step"><span class="step-dot">4</span><span>AI Chat</span></div>
            <div class="journey-step active"><span class="step-dot">5</span><span>C·ªông ƒë·ªìng</span></div>
        </div>
    </div>

    <div class="community-wrapper">
        
        <!-- LEFT COLUMN: Navigation & Metrics -->
        <aside class="comm-sidebar-left">
            <!-- Navigation Menu -->
            <div class="panel panel-soft" style="padding: 10px;">
                <div class="sidebar-menu-item active" onclick="setCommunityExploreMode('discover')">
                    <span class="sidebar-icon">üì∞</span>
                    <span>B·∫£ng tin</span>
                </div>
                <div class="sidebar-menu-item" onclick="setCommunityExploreMode('rag')">
                    <span class="sidebar-icon">ü§ñ</span>
                    <span>H·ªèi AI C·ªông ƒë·ªìng</span>
                </div>
                <div class="sidebar-menu-item" onclick="goPage('chatbot')">
                    <span class="sidebar-icon">üí¨</span>
                    <span>AI Mentor</span>
                </div>
                <div class="sidebar-menu-item" onclick="goPage('results')">
                    <span class="sidebar-icon">üìä</span>
                    <span>H·ªì s∆° c·ªßa t√¥i</span>
                </div>
            </div>

            <!-- Community Metrics -->
            <div id="communityMetricsPanel" class="panel panel-soft" style="margin-top: 20px;">
                <div class="community-metrics-head">
                    <h3>Ch·ªâ s·ªë s√¥i ƒë·ªông</h3>
                </div>
                <div id="communityMetricsGrid" class="community-metrics-grid">
                    <div class="muted">ƒêang t·∫£i ch·ªâ s·ªë...</div>
                </div>
            </div>
        </aside>

        <!-- CENTER COLUMN: Feed & Composer -->
        <main class="comm-feed">
            
            <!-- 1. The Composer (Facebook Style) -->
            <div class="panel" style="padding: 0; margin-bottom: 20px;">
                <div class="fb-composer-trigger" onclick="openCommunityComposerModal()">
                    <div class="fb-avatar-circle"><!-- User Avatar Img here --></div>
                    <div class="fb-input-fake">B·∫°n ƒëang nghƒ© g√¨ v·ªÅ ƒë·ªãnh h∆∞·ªõng ngh·ªÅ nghi·ªáp?</div>
                </div>
                <div style="display: flex; border-top: 1px solid #eee; padding: 8px;">
                    <button class="btn btn-secondary" style="flex:1; border:none;" onclick="openCommunityComposerModal()">
                        ‚ùì ƒê·∫∑t c√¢u h·ªèi
                    </button>
                    <button class="btn btn-secondary" style="flex:1; border:none;" onclick="openCommunityComposerModal()">
                        üìù Chia s·∫ª
                    </button>
                </div>
            </div>

            <!-- 2. RAG/Search Section (Hidden/Shown based on tab) -->
            <div id="communityRagModePanel" class="panel panel-soft" role="region" aria-label="Ch·∫ø ƒë·ªô h·ªèi ƒë√°p c·ªông ƒë·ªìng" hidden style="margin-bottom: 20px;">
                <h3>H·ªèi ƒë√°p RAG</h3>
                <p class="helper-text">AI s·∫Ω t√¨m c√¢u tr·∫£ l·ªùi t·ª´ c√°c th·∫£o lu·∫≠n c≈©.</p>
                <div class="community-rag-row">
                    <input id="communityRagQuestion" class="community-input" type="text"
                        placeholder="V√≠ d·ª•: Em l·ªõp 12 n√™n ∆∞u ti√™n k·ªπ nƒÉng n√†o ƒë·ªÉ theo ng√†nh CNTT?">
                    <button class="btn btn-primary" onclick="askCommunityRag()">H·ªèi</button>
                </div>
                <div id="communityRagStatus" class="status" role="status" aria-live="polite"></div>
                <div id="communityRagAnswer" class="community-rag-answer muted">Ch∆∞a c√≥ c√¢u tr·∫£ l·ªùi.</div>
            </div>

            <!-- 3. Feed Filters & Controls -->
            <div id="communityDiscoverModePanel" class="panel panel-soft" style="padding: 0; margin-bottom: 20px;">
                <div class="fb-filters">
                    <strong style="font-size: 1.1rem;">B√†i vi·∫øt</strong>
                    <div style="display: flex; gap: 10px;">
                        <select id="communityCategoryFilter" class="community-input" style="padding: 5px;"
                            onchange="changeCommunityCategoryFilter(this.value)">
                            <option value="all">T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>
                            <option value="general">Chung</option>
                            <option value="major">Ng√†nh h·ªçc</option>
                            <option value="skills">K·ªπ nƒÉng</option>
                            <option value="admissions">Tuy·ªÉn sinh</option>
                        </select>
                        <select id="communitySort" class="community-input" style="padding: 5px;" onchange="changeCommunitySort(this.value)">
                            <option value="newest">M·ªõi nh·∫•t</option>
                            <option value="most_commented">N·ªïi b·∫≠t</option>
                        </select>
                    </div>
                </div>
                <!-- Search Bar hidden inside filter panel -->
                <div style="padding: 0 16px 16px 16px;">
                    <input id="communitySearch" class="community-input community-search-input" type="text"
                    placeholder="üîç T√¨m ki·∫øm b√†i vi·∫øt..." oninput="changeCommunitySearch(this.value)">
                </div>
            </div>

            <!-- 4. Posts Stream -->
            <div id="postsContainer" class="posts-container" aria-live="polite" style="display: flex; flex-direction: column; gap: 20px;">
                <div class="spinner community-feed-spinner"></div>
            </div>

            <!-- Pagination -->
            <div id="communityPagination" class="panel panel-soft" aria-live="polite" style="margin-top: 20px; text-align: center;">
                <div id="communityPaginationSummary" class="muted">ƒêang t·∫£i ph√¢n trang...</div>
                <div class="community-pagination-actions" style="margin-top: 10px;">
                    <button id="communityPrevPageBtn" class="btn btn-secondary" onclick="goCommunityPrevPage()">Trang tr∆∞·ªõc</button>
                    <button id="communityNextPageBtn" class="btn btn-secondary" onclick="goCommunityNextPage()">Trang sau</button>
                </div>
            </div>
        </main>

        <!-- RIGHT COLUMN: Widgets & Extras -->
        <aside class="comm-sidebar-right">
            <!-- Next Step Card -->
            <div class="journey-next panel">
                <strong>B∆∞·ªõc ti·∫øp theo</strong>
                <p class="muted" style="font-size: 0.9rem;">Sau khi tham kh·∫£o c·ªông ƒë·ªìng, h√£y quay l·∫°i AI ƒë·ªÉ ch·ªët k·∫ø ho·∫°ch.</p>
                <button class="btn btn-primary w-100" style="margin-top: 10px;" onclick="goPage('chatbot')">Quay l·∫°i AI Chat</button>
            </div>

            <!-- Related Posts (Sticky-ish) -->
            <div class="community-related-block panel panel-soft" style="margin-top: 20px;">
                <h4>C√≥ th·ªÉ b·∫°n quan t√¢m</h4>
                <p id="communityViewingRelatedHint" class="helper-text">Ch·ªçn "Li√™n quan" tr√™n m·ªôt b√†i vi·∫øt ƒë·ªÉ xem.</p>
                <div id="communityViewingRelated" class="community-suggest-grid">
                    <div class="muted">Ch∆∞a ch·ªçn b√†i vi·∫øt.</div>
                </div>
            </div>

            <!-- Admin Panel (Only shows if admin) -->
            <div id="communityAdminReports" class="admin-only panel panel-soft" style="margin-top: 20px; border-left: 4px solid red;">
                <h4>üõ°Ô∏è Admin Zone</h4>
                <p class="helper-text">B√°o c√°o g·∫ßn ƒë√¢y.</p>
                <div id="communityAdminReportsStatus" class="status"></div>
                <div id="communityAdminReportsList" class="community-reports-list muted">Ch∆∞a c√≥ d·ªØ li·ªáu.</div>
            </div>
            
             <div class="footer-links muted" style="margin-top: 20px; font-size: 0.8rem; text-align: center;">
                Privacy ¬∑ Terms ¬∑ CareerGo ¬© 2026
            </div>
        </aside>

    </div> <!-- End Grid Wrapper -->
</section>
{% endblock %}

{% block modals %}
<!-- Modals kept exactly same as original functionality -->
<div id="communityReportModal" class="loading-overlay" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="communityReportTitle"
    tabindex="-1">
    <div class="loading-modal panel report-modal-card">
        <h2 id="communityReportTitle" class="section-title report-modal-title">B√°o c√°o n·ªôi dung</h2>
        <p id="communityReportTarget" class="muted report-modal-target"></p>
        <div class="field">
            <label for="communityReportReason">L√Ω do b√°o c√°o</label>
            <select id="communityReportReason" class="community-input">
                <option value="spam">Spam / qu·∫£ng c√°o</option>
                <option value="abuse">Ng√¥n t·ª´ x√∫c ph·∫°m</option>
                <option value="misinformation">Th√¥ng tin sai l·ªách</option>
                <option value="offtopic">Kh√¥ng li√™n quan ch·ªß ƒë·ªÅ</option>
                <option value="other">Kh√°c</option>
            </select>
        </div>
        <div class="field">
            <label for="communityReportDetail">M√¥ t·∫£ th√™m (tu·ª≥ ch·ªçn)</label>
            <textarea id="communityReportDetail" class="community-input" rows="3" maxlength="300"
                placeholder="M√¥ t·∫£ ng·∫Øn ƒë·ªÉ Admin x·ª≠ l√Ω nhanh h∆°n..."></textarea>
        </div>
        <div class="center-actions report-modal-actions">
            <button class="btn btn-secondary" onclick="closeCommunityReportModal()">H·ªßy</button>
            <button class="btn btn-primary" onclick="submitCommunityReport()">G·ª≠i b√°o c√°o</button>
        </div>
        <div id="communityReportStatus" class="status" role="status" aria-live="polite"></div>
    </div>
</div>

<div id="communityComposerModal" class="loading-overlay" role="dialog" aria-modal="true" aria-hidden="true"
    aria-labelledby="communityComposerTitle" tabindex="-1">
    <div class="loading-modal panel community-compose-modal-card">
        <div class="community-compose-head">
            <h2 id="communityComposerTitle" class="section-title">T·∫°o b√†i vi·∫øt m·ªõi</h2>
            <button type="button" class="icon-btn" onclick="closeCommunityComposerModal()" aria-label="ƒê√≥ng c·ª≠a s·ªï so·∫°n b√†i">&times;</button>
        </div>
        <div class="community-write-guide">
            <p class="helper-text">G·ª£i √Ω vi·∫øt b√†i t·ªët: n√™u r√µ l·ªõp/ng√†nh quan t√¢m, v·∫•n ƒë·ªÅ b·∫°n ƒëang g·∫∑p v√† m·ª•c ti√™u b·∫°n mu·ªën ƒë·∫°t.</p>
        </div>
        <input type="text" id="postTitle" placeholder="Ti√™u ƒë·ªÅ b√†i vi·∫øt..." class="community-input" maxlength="100">
        <p class="helper-text">Ti√™u ƒë·ªÅ ng·∫Øn g·ªçn, r√µ v·∫•n ƒë·ªÅ (v√≠ d·ª•: ‚ÄúN√™n ch·ªçn CNTT hay Thi·∫øt k·∫ø ƒë·ªì h·ªça?‚Äù).</p>
        <select id="postCategory" class="community-input community-category-select">
            <option value="general">Chung</option>
            <option value="major">Ng√†nh h·ªçc</option>
            <option value="skills">K·ªπ nƒÉng</option>
            <option value="admissions">Tuy·ªÉn sinh</option>
            <option value="study">Kinh nghi·ªám h·ªçc t·∫≠p</option>
            <option value="mindset">T√¢m l√Ω</option>
        </select>
        <p class="helper-text">Ch·ªçn ƒë√∫ng ch·ªß ƒë·ªÅ ƒë·ªÉ b√†i vi·∫øt d·ªÖ ƒë∆∞·ª£c ph·∫£n h·ªìi b·ªüi ƒë√∫ng ng∆∞·ªùi.</p>
        <input type="text" id="postAuthor" placeholder="T√™n c·ªßa b·∫°n (ho·∫∑c nickname)..." class="community-input">
        <p id="postAuthorHelp" class="helper-text"></p>
        <textarea id="postContent" rows="4" placeholder="B·∫°n ƒëang nghƒ© g√¨? H√£y chia s·∫ª th·∫Øc m·∫Øc ho·∫∑c √Ω t∆∞·ªüng..."
            class="community-input"></textarea>
        <p class="helper-text">M√¥ t·∫£ c·ª• th·ªÉ ho√†n c·∫£nh c·ªßa b·∫°n ƒë·ªÉ c·ªông ƒë·ªìng ƒë∆∞a l·ªùi khuy√™n ch√≠nh x√°c h∆°n.</p>
        <p id="communityDraftSaveStatus" class="muted">Nh√°p b√†i vi·∫øt ch∆∞a ƒë∆∞·ª£c l∆∞u.</p>
        <div class="community-related-block">
            <h4>B√†i vi·∫øt li√™n quan khi b·∫°n ƒëang so·∫°n</h4>
            <div id="communityDraftRelated" class="community-suggest-grid">
                <div class="muted">Nh·∫≠p ti√™u ƒë·ªÅ ho·∫∑c n·ªôi dung ƒë·ªÉ xem g·ª£i √Ω li√™n quan.</div>
            </div>
        </div>
        <div class="center-actions report-modal-actions">
            <button class="btn btn-secondary" onclick="closeCommunityComposerModal()">H·ªßy</button>
            <button class="btn btn-primary" onclick="createPost()">ƒêƒÉng b√†i</button>
        </div>
        <div id="communityStatus" class="status" role="status" aria-live="polite"></div>
    </div>
</div>

<div id="communityPostDetailModal" class="loading-overlay" role="dialog" aria-modal="true" aria-hidden="true"
    aria-labelledby="communityPostDetailTitle" tabindex="-1">
    <div class="loading-modal panel community-post-detail-card">
        <div class="community-compose-head">
            <h2 id="communityPostDetailTitle" class="section-title">Chi ti·∫øt b√†i vi·∫øt</h2>
            <button type="button" class="icon-btn" onclick="closeCommunityPostDetailModal()" aria-label="ƒê√≥ng chi ti·∫øt b√†i vi·∫øt">&times;</button>
        </div>
        <div id="communityPostDetailBody" class="community-post-detail-body">
            <div class="muted">ƒêang t·∫£i chi ti·∫øt b√†i vi·∫øt...</div>
        </div>
        <div id="communityPostDetailStatus" class="status" role="status" aria-live="polite"></div>
    </div>
</div>
{% endblock %}